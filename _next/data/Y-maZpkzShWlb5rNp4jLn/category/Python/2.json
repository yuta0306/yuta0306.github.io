{"pageProps":{"CategoricalPostData":[{"contentHtml":"<p>Transformersを使って入力テキストをtokenizeするときに，データセットのサイズが大きかったので，バッチ単位でエンコードしたかった時がありました．</p>\n<p>この時，collate_fnに対して複数の引数を与えたかった状況の時の対処法です．(日本語変か?)</p>\n<h2>やりたかったこと</h2>\n<p>DataLoaderを定義するときに，<code>collate_fn</code>のところで自作collate_fnを指定して，batch単位で流れてくるデータに対してエンコードすること．</p>\n<p>これがやりたいことになります．つまりこんな感じ</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> torch.utils <span class=\"hljs-keyword\">import</span> Dataset, DataLoader\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyDataset</span>(<span class=\"hljs-params\">Dataset</span>):</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, *args, **kwargs</span>):</span>\n        <span class=\"hljs-built_in\">super</span>().__init__()\n        ...\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__len__</span>(<span class=\"hljs-params\">self</span>):</span>\n        ...\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__getitem__</span>(<span class=\"hljs-params\">self, idx: <span class=\"hljs-built_in\">int</span></span>):</span>\n        ...\n\ndataloader = DataLoader(dataset=MyDataset(), batch_size=<span class=\"hljs-number\">16</span>, shuffle=<span class=\"hljs-literal\">True</span>,\n            num_workers=os.cpu_count(),\n            collate_fn=custom_collate_fn)  <span class=\"hljs-comment\"># &#x3C;--- ここで自作collate_fnを指定して制御</span></code></pre>\n<h2>やってうまくいかなかったこと</h2>\n<p>先にやってうまくいかなかったことを共有しておきます．</p>\n<p>自分が使っているのが，<code>pytorch-lightning</code>なのでそのせいもあるかもしれません．なので，もしかしたら普通に素のPytorchならうまくいくかもしれません．</p>\n<p>教えてください🙏</p>\n<h3>lambda式で制御する (functools.partialを使う)</h3>\n<p>こんなことをしました．</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> torch.utils <span class=\"hljs-keyword\">import</span> Dataset, DataLoader\n<span class=\"hljs-keyword\">from</span> transformers <span class=\"hljs-keyword\">import</span> AutoTokenizer\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyDataset</span>(<span class=\"hljs-params\">Dataset</span>):</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, *args, **kwargs</span>):</span>\n        <span class=\"hljs-built_in\">super</span>().__init__()\n        ...\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__len__</span>(<span class=\"hljs-params\">self</span>):</span>\n        ...\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__getitem__</span>(<span class=\"hljs-params\">self, idx: <span class=\"hljs-built_in\">int</span></span>):</span>\n        ...\n        <span class=\"hljs-keyword\">return</span> text, label\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">custom_collate_fn</span>(<span class=\"hljs-params\">data, tokenizer, max_length</span>):</span>\n    texts, labels = <span class=\"hljs-built_in\">zip</span>(*data)\n    texts = <span class=\"hljs-built_in\">list</span>(texts)\n    texts = tokenizer.batch_encode_plus(\n        texts,\n        padding=<span class=\"hljs-literal\">True</span>,\n        truncation=<span class=\"hljs-literal\">True</span>,\n        max_length=max_length,\n        return_tensors=<span class=\"hljs-string\">'pt'</span>,\n    )\n    labels = torch.LongTensor(labels)\n    <span class=\"hljs-keyword\">return</span> texts, labels\n\ntokenizer = AutoTokenizer.from_pretrained(...)\nmax_length = <span class=\"hljs-number\">256</span>\ndataloader = DataLoader(dataset=MyDataset(), batch_size=<span class=\"hljs-number\">16</span>, shuffle=<span class=\"hljs-literal\">True</span>,\n            num_workers=os.cpu_count(),\n            collate_fn=<span class=\"hljs-keyword\">lambda</span> data: custom_collate_fn(data, tokenizer, max_length))</code></pre>\n<p><code>pytorch-lightning</code>の仕様だとは思うのですが，<code>pickle</code>で圧縮するらしくそのタイミングでエラーを吐かれました．</p>\n<p>なぜだろう...有識者の方教えてください...</p>\n<h2>【解決策】 classで定義する</h2>\n<p>lambda式でダメだったので，もうクラスの内部に必要なものを保持させておこうということになりました．(僕の中では)</p>\n<p>次のコードのような感じで解決しました．</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> torch.utils <span class=\"hljs-keyword\">import</span> Dataset, DataLoader\n<span class=\"hljs-keyword\">from</span> transformers <span class=\"hljs-keyword\">import</span> AutoTokenizer\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyDataset</span>(<span class=\"hljs-params\">Dataset</span>):</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, *args, **kwargs</span>):</span>\n        <span class=\"hljs-built_in\">super</span>().__init__()\n        ...\n    \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__len__</span>(<span class=\"hljs-params\">self</span>):</span>\n        ...\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__getitem__</span>(<span class=\"hljs-params\">self, idx: <span class=\"hljs-built_in\">int</span></span>):</span>\n        ...\n        <span class=\"hljs-keyword\">return</span> text, label\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CollateFn</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, tokenizer, max_length: <span class=\"hljs-built_in\">int</span></span>) -> <span class=\"hljs-literal\">None</span>:</span>\n        self.tokenizer = tokenizer\n        self.max_length = max_length\n        os.environ[<span class=\"hljs-string\">\"TOKENIZERS_PARALLELISM\"</span>] = <span class=\"hljs-string\">\"true\"</span>  <span class=\"hljs-comment\"># &#x3C;--- 多分これを明示的に指定しないと怒られます (true|false)</span>\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__call__</span>(<span class=\"hljs-params\">self, data</span>):</span>\n        texts, labels = <span class=\"hljs-built_in\">zip</span>(*data)\n        texts = <span class=\"hljs-built_in\">list</span>(texts)\n        texts = self.tokenizer.batch_encode_plus(\n            texts,\n            padding=<span class=\"hljs-literal\">True</span>,\n            truncation=<span class=\"hljs-literal\">True</span>,\n            max_length=self.max_length,\n            return_tensors=<span class=\"hljs-string\">'pt'</span>,\n        )\n        labels = torch.LongTensor(labels)\n        <span class=\"hljs-keyword\">return</span> texts, labels\n\ntokenizer = AutoTokenizer.from_pretrained(...)\nmax_length = <span class=\"hljs-number\">256</span>\ndataloader = DataLoader(dataset=MyDataset(), batch_size=<span class=\"hljs-number\">16</span>, shuffle=<span class=\"hljs-literal\">True</span>,\n            num_workers=os.cpu_count(),\n            collate_fn=CollateFn(tokenizer, max_length))</code></pre>\n<h2>まとめ</h2>\n<p>素のPytorchで組めば問題なかったのかもしれませんが，<code>pytorch-lightning</code>を使っている方は同じ状況になるかもしれません．</p>\n<p>その時は，ぜひ参考にclassでcollate_fnで実装してみて解決の一助となれたら幸いです．</p>\n","Title":"collate_fnで複数の引数を取りたい!!","Date":"2021-12-24","Category":"Python","Tags":["ML","Python","Pytorch"],"Authors":"ゆうぼう","Slug":"pytorch-collate_fn-args","Thumbnail":"/images/thumbnails/pytorch-logo.jpg","Description":"Transformersを使って入力テキストをtokenizeするときに，データセットのサイズが大きかったので，バッチ単位でエンコードしたかった時がありました．この時，collate_fnに対して複数の引数を与えたかった状況の時の対処法です．(日本語変かも)","Published":true},{"contentHtml":"<p>Colab Proでなんとかpytorch-lightningを使ってTPUで実験を回そうと奮闘した結果，得られたベストプラクティス?(怪しい)の共有です．</p>\n<p>もっといい方法があったら教えてください．</p>\n<p>ちなみに，現行コンペで動作確認したので，コード全容の公開はないです．すみません．</p>\n<p><strong>Runtimeは必ずTPUにしてください</strong></p>\n<h2>pytorch-lightningでTPUを使いたいメリット?</h2>\n<p>黙って<em>tensorflow</em>を勉強して書けば，それでいいのでしょうが，<br>\n普段<em>pytorch</em>を使ってコーディングをしていて，僕の場合<em>pytorch-lightning</em>を好んで使っているので，その延長戦でTPUを使いたいという欲がありました．</p>\n<p>また，<em>pytorch-lightning</em>は，<strong>Trainerクラス</strong>をちょろっと書き換えるだけで，CPU/GPU/TPUの変換ができ，マルチGPU等のDDPの処理も自動で書き加えてくれるため，<br>\nかなり良いものかなと思っています．</p>\n<p>CPU/GPU/TPUの書き換えは基本的に以下で十分です．</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> pytorch_lightning <span class=\"hljs-keyword\">as</span> pl\n<span class=\"hljs-comment\"># これらは共通</span>\nmodel = LitModel()  <span class=\"hljs-comment\"># pl.LightningModuleを継承した何か</span>\ndm = LitDataset()  <span class=\"hljs-comment\"># pl.LightningDataModuleを継承した何か</span>\n\n<span class=\"hljs-comment\"># CPUを使う</span>\ntrainer = Trainer()\ntrainer.fit(model, dm)\n\n<span class=\"hljs-comment\"># GPUを使う</span>\ntrainer = Trainer(gpus=-<span class=\"hljs-number\">1</span>)  <span class=\"hljs-comment\"># ありったけのGPU使う</span>\ntrainer.fit(model, dm)\n\n<span class=\"hljs-comment\"># Single Core TPUを使う</span>\ntrainer = Trainer(tpu_cores=[<span class=\"hljs-number\">5</span>])  <span class=\"hljs-comment\"># TPUのインデックス指定</span>\ntrainer.fit(model, dm)\n\n<span class=\"hljs-comment\"># Multi Core TPUを使う</span>\ntrainer = Trainer(tpu_cores=<span class=\"hljs-number\">8</span>)  <span class=\"hljs-comment\"># 1 or 8じゃないと怒られます...</span>\ntrainer.fit(model, dm)</code></pre>\n<p>ああ，楽だ楽だ．</p>\n<p>TPU簡単に動いてくれたらいいのに(願望)</p>\n<h2>TPUを使うためのセットアップ</h2>\n<p>以下を実行して，必要なライブラリ群を入れてしまいます．</p>\n<p>一応僕が動作確認取れたのは，pytorch-xlaのバージョンが<em>1.8</em>と<em>1.9</em>です．</p>\n<p>Circle CIのTPU環境に合わせたユニットテストは，確か1.8が通っていて，1.9がエラーを吐いていた気がします．</p>\n<p>1.8の方が安全なのですかね？(わかりません)</p>\n<p><em>pytorch-xla 1.8</em></p>\n<pre><code class=\"hljs language-python\">!pip install cloud-tpu-client==<span class=\"hljs-number\">0.10</span> https://storage.googleapis.com/tpu-pytorch/wheels/torch_xla-<span class=\"hljs-number\">1.8</span>-cp37-cp37m-linux_x86_64.whl\n!pip install -q torch==<span class=\"hljs-number\">1.8</span> torchvision torchtext\n!pip install -q pytorch-lightning==<span class=\"hljs-number\">1.4</span><span class=\"hljs-number\">.9</span> torchmetrics</code></pre>\n<p><em>pytorch-xla 1.9</em></p>\n<pre><code class=\"hljs language-python\">!pip install cloud-tpu-client==<span class=\"hljs-number\">0.10</span> https://storage.googleapis.com/tpu-pytorch/wheels/torch_xla-<span class=\"hljs-number\">1.9</span>-cp37-cp37m-linux_x86_64.whl\n!pip install -q torch==<span class=\"hljs-number\">1.9</span> torchvision torchtext\n!pip install -q pytorch-lightning==<span class=\"hljs-number\">1.4</span><span class=\"hljs-number\">.9</span> torchmetrics</code></pre>\n<p>pipでのインストール分割していたり，--quit(-q)をつけているのは特に理由はないです．</p>\n<p>その辺はお好みでやってください．</p>\n<p>一応僕の環境ではこんな感じで，以後のプログラムはうまいこと動作しました．</p>\n<p>おそらく以下のようなエラーは起きますが，特に動作に影響はなさそうでした．あまり不安がらなくても良さそうです．</p>\n<pre><code class=\"hljs language-shell\">ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\nearthengine-api 0.1.284 requires google-api-python-client&#x3C;2,>=1.12.1, but you have google-api-python-client 1.8.0 which is incompatible.</code></pre>\n<h2>セットアップ後にimport pytorch_lightning</h2>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> pytorch_lightning <span class=\"hljs-keyword\">as</span> pl</code></pre>\n<p><em>import</em>すると以下のような出力を吐きます．</p>\n<p>インストールした<em>xla</em>のバージョンが1.9ならば，以下のようなメッセージが出ます．</p>\n<p>少し時間がかかりますが，待ちましょう．</p>\n<p><em>pytorch-xla 1.9</em></p>\n<pre><code class=\"hljs language-shell\">WARNING:root:Waiting for TPU to be start up with version pytorch-1.9...\nWARNING:root:Waiting for TPU to be start up with version pytorch-1.9...\nWARNING:root:Waiting for TPU to be start up with version pytorch-1.9...\nWARNING:root:TPU has started up successfully with version pytorch-1.9</code></pre>\n<p>もし，<em>TPU not Found</em>的なことが出たら，一回<em>Factory reset Runtime</em>して，またインストールからやり直せばうまく行くと思います．</p>\n<h2>importまでうまく行けたら</h2>\n<p><em>import</em>するまで行けたら，このあとは特に問題なく動くはずです．</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># ModelとかDataModuleとかは適宜設定してください．</span>\n\ntrainer = Trainer(tpu_cores=<span class=\"hljs-number\">8</span>)\ntrainer.fit(model, dm)</code></pre>\n<p>このあとすぐエラー出なきゃ，勝手に動くと思います(雑ww)</p>\n<h2>注意するべきこと</h2>\n<p>幾つか僕が遭遇したエラーを挙げておきます．</p>\n<ul>\n<li>wandb loggerが使えない\n<ul>\n<li>多分Commet loggerも使えない？</li>\n</ul>\n</li>\n<li>マルチコアTPU使うなら，predict時return_predictionsができない\n<ul>\n<li><em>pytorch_lightning.callbacks.BasePredictionWriter</em>を使おう(<a href=\"#BasePredictionWriter%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB\">サンプル</a>)</li>\n</ul>\n</li>\n<li>なぜか知らんけど，<a href=\"#RAM%E3%81%AE%E4%BD%BF%E7%94%A8%E7%8E%8750%25%E3%81%8F%E3%82%89%E3%81%84%E3%81%AB%E3%81%AA%E3%82%8B%E3%81%A8stack%E3%81%99%E3%82%8B%E4%BB%B6%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"><strong>RAMの使用率が50%あたりになるとstackする</strong></a>\n<ul>\n<li>こうなると一生動かなくなるので，<strong>最初安定するまで監視が必要</strong></li>\n<li>Colabの下のデバッガみたいなやつが，ずっと*select() > spawn()*的な非同期のところで止まるので，そうなったらRAMチェックしよう!!!</li>\n</ul>\n</li>\n</ul>\n<h2>BasePredictionWriterのサンプル</h2>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> pytorch_lightning.callbacks <span class=\"hljs-keyword\">import</span> BasePredictionWriter\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CustomWriter</span>(<span class=\"hljs-params\">BasePredictionWriter</span>):</span>\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, output_dir: <span class=\"hljs-built_in\">str</span>, write_interval: <span class=\"hljs-built_in\">str</span> = <span class=\"hljs-string\">'batch'</span></span>):</span>\n        <span class=\"hljs-built_in\">super</span>().__init__(write_interval)\n        self.output_dir = output_dir\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">write_on_batch_end</span>(<span class=\"hljs-params\">\n        self, trainer, pl_module: <span class=\"hljs-string\">'LightningModule'</span>, prediction: <span class=\"hljs-type\">Any</span>, batch_indices: <span class=\"hljs-type\">List</span>[<span class=\"hljs-built_in\">int</span>], batch: <span class=\"hljs-type\">Any</span>,\n        batch_idx: <span class=\"hljs-built_in\">int</span>, dataloader_idx: <span class=\"hljs-built_in\">int</span>\n    </span>):</span>\n        torch.save(prediction, os.path.join(self.output_dir, dataloader_idx, <span class=\"hljs-string\">f\"<span class=\"hljs-subst\">{batch_idx}</span>.pt\"</span>))\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">write_on_epoch_end</span>(<span class=\"hljs-params\">\n        self, trainer, pl_module: <span class=\"hljs-string\">'LightningModule'</span>, predictions: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">Any</span>], batch_indices: <span class=\"hljs-type\">List</span>[<span class=\"hljs-type\">Any</span>]\n    </span>):</span>\n        torch.save(predictions, os.path.join(self.output_dir, <span class=\"hljs-string\">\"predictions.pt\"</span>))</code></pre>\n<h2>RAMの使用率50%くらいになるとstackする件について</h2>\n<p>はっきり言って，これは本当に原因がわかりません．</p>\n<p>50%くらいで張りついちゃうので，batch_size下げようが，RAMの使用率はあまり変わる気がしません．</p>\n<p>こうなってstackしちゃったら，もうHigh-RAM設定にしてRAMにゆとりを持たせた方がいいと思います．潔く．</p>\n<p>High-RAMでも張りついちゃう場合は，僕はわかりません．</p>\n<p>RAM周りの最適化とか知見ある方，解決策わかったら共有してくださるととてもありがたいです......</p>\n<h2>まとめ</h2>\n<p>まとめじゃないです．嘘つきました．</p>\n<p>でも，まとめないとなんかあれなので，CPU/GPU/TPUで使いまわせるように，セットアップの部分整理します．</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> sys\n\n<span class=\"hljs-keyword\">if</span> os.environ.get(<span class=\"hljs-string\">'COLAB_TPU_ADDR'</span>, <span class=\"hljs-literal\">False</span>):\n    !pip install cloud-tpu-client==<span class=\"hljs-number\">0.10</span> https://storage.googleapis.com/tpu-pytorch/wheels/torch_xla-<span class=\"hljs-number\">1.8</span>-cp37-cp37m-linux_x86_64.whl\n    !pip install -q torch==<span class=\"hljs-number\">1.8</span> torchvision torchtext\n\n!pip install pytorch-lightning==<span class=\"hljs-number\">1.4</span><span class=\"hljs-number\">.9</span> torchmetrics</code></pre>\n<p>もし，KaggleとColabでも行けるようにしたいのであれば，<code>'google.colab' in sys.modules</code>でやるといいと思います．</p>\n<p>Colab TPU使って，pytorch-lightningでうまく実験回しまくっている方いたら，色々意見ください．お願いします :)</p>\n<p>知見たまって，エラーハンドリングとかわかってきたら，この記事更新するか，新たに書き始めます．よろしくお願いします．</p>\n","Title":"Pytorch LightningでTPUを回す on Colab Pro in 2021","Date":"2021-10-11","Category":"Python","Tags":["pytorch-lightning","Colab"],"Authors":"ゆうぼう","Slug":"pytorch-lightning_on_colab-tpu_2021","Thumbnail":"/images/thumbnails/pytorch-lightning_on_colab-pro-tpu.png","Description":"Colab Proでなんとかpytorch-lightningを使ってTPUで実験を回そうと奮闘した結果，得られたベストプラクティスの共有です．もっといい方法があったら教えてください．","Published":true},{"contentHtml":"<p>対話システムをサーバ上で動かせる体制を作るために，pytorchやら何やらをHerokuでinstallさせる必要があったのですが，**pytorchちょっとデカすぎませんか？**という状態でエラーが出てしまいました．その時の解消法です．</p>\n<h2>Pytorchデカすぎませんか？</h2>\n<p>Herokuはデプロイ時には，500MBに収まる必要があるのですが，<br>\nまさかのpytorchは<strong>831.4 MB</strong>.</p>\n<p>は？</p>\n<p><img src=\"/images/article/torch-weight.png\" alt=\"Pytorchの容量\"></p>\n<p>正直焦りました．</p>\n<p>躓くところ，そことは想定していなかったので（笑）</p>\n<p>なんとか500MBに収める方法次に紹介します．</p>\n<h2>【解消法】 CPUのみ対応版をinstallさせる</h2>\n<p>色々調べてみたところ，原因は，<strong>CPU/GPU両対応のため色々入って重い</strong>ことらしいです．</p>\n<p>そういうことなので，CPUのみに対応させることにしました．(HerokuもCPUしか動作させられないので...)</p>\n<p>requirements.txtを多少工夫します．</p>\n<h3>変更前のrequirements.txt</h3>\n<pre><code class=\"hljs language-python\">...\ntorch==<span class=\"hljs-number\">1.9</span><span class=\"hljs-number\">.0</span>\n...</code></pre>\n<h3>変更後のrequirements.txt</h3>\n<p>インターネット上のファイルを参照させます．</p>\n<pre><code class=\"hljs language-python\">-f https://download.pytorch.org/whl/torch_stable.html\ntorch==<span class=\"hljs-number\">1.9</span><span class=\"hljs-number\">.0</span>+cpu</code></pre>\n<p>こうすることで，どうしてもサイズがでかいままですが，元よりはかなり圧縮できました．</p>\n<p><img src=\"/images/article/torch-cpu-weight.png\" alt=\"Pytorch軽量後の容量\"></p>\n<p>831.4 → 175.5ダウンなので，かなり軽量化した感じがします．</p>\n<h2>やってみたけどダメだったこと</h2>\n<p>上記のCPUのみ対応版にする前にやってみたが，ダメだったことがあります．</p>\n<p>デプロイ後に，「<em>pip install torch</em>」を含むrun.shを走らせてインストールさせることです．</p>\n<p>うまくいくと思ったのですが，重すぎてOut of Memoryでした...</p>\n","Title":"Pytorch, Herokuにはデカすぎる問題","Date":"2021-09-30","Category":"Python","Tags":["Heroku"],"Authors":"ゆうぼう","Slug":"heroku-install-torch","Thumbnail":"/images/thumbnails/heroku-install-torch.png","Description":"対話システムをサーバ上で動かせる体制を作るために，pytorchやら何やらをHerokuでinstallさせる必要があったのですが，pytorchちょっとデカすぎませんか？という状態でエラーが出てしまいました．その時の解消法です．","Published":true},{"contentHtml":"<p><em>pip install tensorflow</em>でtensorflowをインストールしてディープラーニングをやろうとした矢先の事、パッケージが足りないだと...。その時の解決策がとても簡単だったのですが、この手の問題はtensorflowに限らず起こりそうなので、記録しておきます。</p>\n<h2>発生したエラー No such file or directory</h2>\n<p>今回はなぜかインストールに必要なパッケージのメタファイルがなくて、「No such file or directory」と怒られたわけです。</p>\n<p>そして、今回足りなかったパケージが<strong>google_pasta-0.2.0.dist-info/METADATA</strong>でした。</p>\n<p>実際のエラーが以下になります。</p>\n<pre><code class=\"hljs language-bash\">ERROR: Could not install packages due to an EnvironmentError:\n[Errno 2] No such file or directory:\n<span class=\"hljs-string\">'/Users/usr/opt/anaconda3/envs/myenv/lib/python3.7/site-packages/google_pasta-0.2.0.dist-info/METADATA'</span></code></pre>\n<h2>【解決策】もうtouchでファイル作っちゃえ!!</h2>\n<p>よくわからないエラーだし、本当になんでこうなったかの経緯が掴めないのですが、<br>\nファイルがないとかディレクトリがないとか言っているのでとりあえず<em>もうファイル作っちゃえ!!</em></p>\n<p>という事で<strong>touch</strong>でファイル作っちゃいます(笑)</p>\n<pre><code class=\"hljs language-bash\">$ touch /Users/usr/opt/anaconda3/envs/myenv/lib/python3.7/site-packages/google_pasta-0.2.0.dist-info/METADATA\n$ <span class=\"hljs-comment\"># 上のファイルパスはエラー文のコピペ</span>\n$\n$ pip install tensorflow</code></pre>\n<p>さっきまでのエラーが原因であれば、これでインストールが完了しているはずです!</p>\n<p>まあ、今回はconda環境で起こった問題なので、何かしらcondaの中でやってはいけないコマンドか何かがあったのかなって感じです。</p>\n<p>とにかくこのエラーが出たらどうにかなるということで、これからは対処できそうです。</p>\n<p>クリスマスイヴの投稿でした \\o/<br>\nそれでは、楽しく機械学習をハックしていきましょう!!</p>\n","Title":"tensorflowインストール時 METADATAがない？","Date":"2020-12-24","Category":"Python","Tags":["Python","tensorflow"],"Authors":"ゆうぼう","Slug":"tf-install-err","Thumbnail":"/images/thumbnails/python.jpg","Description":"pip install tensorflowでtensorflowをインストールしてディープラーニングをやろうとした矢先の事、パッケージが足りないだと...。その時の解決策がとても簡単だったのですが、この手の問題はtensorflowに限らず起こりそうなので、記録しておきます。","Published":true},{"contentHtml":"<p>今回は、<strong>多次元配列で*演算には注意しないと、バグが起こるよ</strong>ってことを話します。1年Pythonを描き続けましたが知らなかったので、これは共有させていただきますね。Pythonは、ポインタだの参照だのを意識しなくても良い言語だと思うんですが、これは知っておくべきです。</p>\n<h2>実験方法</h2>\n<p>各配列がどの参照をしているかを注目してみましょう。今回の実験は、以下の流れをとります。</p>\n<ol>\n<li>2次元配列を定義 &#x3C;- 様々な方法をとります</li>\n<li>中の配列の0番目append(0)をする</li>\n<li>実験結果の確認</li>\n</ol>\n<p>それでは早速実験です。対話モードにて行います。</p>\n<h2>シンプルに定義</h2>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">>>> </span>l = [[], [], []]\n<span class=\"hljs-meta\">>>> </span>l[<span class=\"hljs-number\">0</span>].append(<span class=\"hljs-number\">0</span>)\n\n<span class=\"hljs-meta\">>>> </span>l\n\n[[<span class=\"hljs-number\">0</span>], [], []]</code></pre>\n<p>これはおそらく考えていた通りですね。問題なし。</p>\n<h2>+演算で定義</h2>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">>>> </span>l = [[]] + [[]] + [[]]\n<span class=\"hljs-meta\">>>> </span>l[<span class=\"hljs-number\">0</span>].append(<span class=\"hljs-number\">0</span>)\n\n<span class=\"hljs-meta\">>>> </span>l\n\n[[<span class=\"hljs-number\">0</span>], [], []]</code></pre>\n<p>これも想定した通り。問題なし。</p>\n<h2>*演算で定義</h2>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">>>> </span>l = [[]] * <span class=\"hljs-number\">3</span>\n<span class=\"hljs-meta\">>>> </span>l[<span class=\"hljs-number\">0</span>].append(<span class=\"hljs-number\">0</span>)\n\n<span class=\"hljs-meta\">>>> </span>l\n\n[[<span class=\"hljs-number\">0</span>], [<span class=\"hljs-number\">0</span>], [<span class=\"hljs-number\">0</span>]]</code></pre>\n<p>......ん？？？？</p>\n<p>全ての要素配列に0が足してありますね...これは知らんかったやつ...</p>\n<h2>*演算に注意!!!</h2>\n<p>*演算で配列を定義する際には注意しましょう。</p>\n<p>シンプルに定義した場合や+によって定義した配列は、それぞれの配列は別のものとして定義されています。</p>\n<p>しかし、*によって定義されたものは、演算対象となった配列の参照そのものさえもコピーされて作られてしまいます。</p>\n<p>まとまった挙動を示して欲しいのであれば問題ないですが、大きなくくりの配列にある要素配列に対しては別々に動いて欲しい場合はかなり注意が必要です。</p>\n<p>このことを知っておくだけでもバグが出た時に冷静に対処できると思うので、ぜひ覚えておきましょう。</p>\n","Title":"【Python】多次元の不用意な*演算には注意!!","Date":"2020-11-27","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"mul-list-ref","Thumbnail":"/images/thumbnails/python.jpg","Description":"今回は、多次元配列で\\*演算には注意しないと、バグが起こるよってことを話します。1年Pythonを描き続けましたが知らなかったので、これは共有させていただきますね。Pythonは、ポインタだの参照だのを意識しなくても良い言語だと思うんですが、これは知っておくべきです。","Published":true},{"contentHtml":"<p>Pythonで他にはない特殊な書き方といえば、<strong>内包表記</strong>ですかね。Haskellでもかけるみたいな話聞いたことあるけど。実際内包表記は読みやすく、たいてい高速に動くので推奨される書き方と思います。ベンチマークを測ってみたので参考になればと。</p>\n<h2>今回のコード</h2>\n<p>今回速さを測るための指標となるコードは以下になります。</p>\n<p>至ってシンプルなforループが以下です。</p>\n<pre><code class=\"hljs language-python\">symbols = <span class=\"hljs-string\">'$¢£¥€¤'</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">non_ascii</span>(<span class=\"hljs-params\">c</span>):</span>\n    <span class=\"hljs-keyword\">return</span> c > <span class=\"hljs-number\">127</span>\ncodes = []\n<span class=\"hljs-keyword\">for</span> s <span class=\"hljs-keyword\">in</span> symbols:\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">ord</span>(s) > <span class=\"hljs-number\">127</span>:\n        codes.append(<span class=\"hljs-built_in\">ord</span>(s))</code></pre>\n<p>これを下に複数の書き方に対して処理速度を測ります。</p>\n<h2>いざ実験</h2>\n<p>今回試すものが以下になります。</p>\n<ol>\n<li>ただのforループ</li>\n<li>内包表記</li>\n<li>内包表記 + 自作関数(non_adcii)</li>\n<li>filter + lambda</li>\n<li>filter + 自作関数(non_ascii)</li>\n</ol>\n<p>これらに関して測ってみます。\nコードが以下になります。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> timeit\nTIMES = <span class=\"hljs-number\">10000</span>\nSETUP = <span class=\"hljs-string\">\"\"\"\nsymbols = '$¢£¥€¤'\ndef non_ascii(c):\n    return c > 127\n\"\"\"</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">clock</span>(<span class=\"hljs-params\">label, cmd</span>):</span>\n    res = timeit.repeat(cmd, setup=SETUP, number=TIMES)\n    <span class=\"hljs-built_in\">print</span>(label, *(<span class=\"hljs-string\">'{:.3f}'</span>.<span class=\"hljs-built_in\">format</span>(x) <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> res))\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    clock(<span class=\"hljs-string\">'for-loop        :'</span>, <span class=\"hljs-string\">'codes = []\\nfor s in symbols:\\n\\tif ord(s) > 127: codes.append(ord(s))\\ncodes'</span>)\n    clock(<span class=\"hljs-string\">'listcomp        :'</span>, <span class=\"hljs-string\">'[ord(s) for s in symbols if ord(s) > 127]'</span>)\n    clock(<span class=\"hljs-string\">'listcomp + func :'</span>, <span class=\"hljs-string\">'[ord(s) for s in symbols if non_ascii(ord(s))]'</span>)\n    clock(<span class=\"hljs-string\">'filter + lambda :'</span>, <span class=\"hljs-string\">'list(filter(lambda c: c > 127, map(ord, symbols)))'</span>)\n    clock(<span class=\"hljs-string\">'filter + func   :'</span>, <span class=\"hljs-string\">'list(filter(non_ascii, map(ord, symbols)))'</span>)</code></pre>\n<p>これらから得られる結果がこんな感じです。(人による)</p>\n<pre><code class=\"hljs language-bash\">for-loop        : 0.009 0.009 0.009 0.009 0.009\nlistcomp        : 0.008 0.008 0.008 0.008 0.008\nlistcomp + func : 0.012 0.013 0.013 0.012 0.012\nfilter + lambda : 0.011 0.013 0.012 0.011 0.013\nfilter + func   : 0.014 0.014 0.014 0.014 0.013</code></pre>\n<p>これはまだループも小さいので差はありませんが、安定して早く動いているのは<strong>内包表記</strong>ですね。</p>\n<p>読みやすく、高速に動くことが多い内包表記でした。実際に導入してみてはいかがでしょか。</p>\n<p>今回は実験だけ示して終わります〜〜.</p>\n","Title":"内包表記でパフォーマンスをあげるのだ！","Date":"2020-11-22","Category":"Python","Tags":["Python"],"Author":"ゆうぼう","Slug":"migrate-listcomp","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonで他にはない特殊な書き方といえば、内包表記ですかね。Haskellでもかけるみたいな話聞いたことあるけど。実際内包表記は読みやすく、たいてい高速に動くので推奨される書き方と思います。ベンチマークを測ってみたので参考になればと。","Published":true},{"contentHtml":"<p><strong>PythonからUNIXコマンドを使いたい</strong>。そんな時があると思います!(多分滅多にないと思うけど)今回は、「ls」コマンドをPythonスクリプトから実行していこうと思います。</p>\n<h2>subpocessモジュールを利用</h2>\n<p>今回の用件を満たすのに必要なのは、「<strong>subprocessモジュール</strong>」になります。Python3.5から*subprocess.run()*というメソッドでサブプロセスをつなげて、コマンドを走らせるという方法が推奨されているみたい...</p>\n<p>os.systemとかos.spawn*の代用だそうですね</p>\n<p>というわけで、<strong>subprocessモジュール</strong>を使用していきます。</p>\n<p>インポートはそのままです。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> subprocess</code></pre>\n<h2>subprocess.run()で実際に走らせる</h2>\n<p>それでは早速「ls」コマンドを走らせてみましょう。(実行結果はディレクトリ構造に依存するので、人により異なります)</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> subprocess\n\nres = subprocess.&#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">function</span>\"><span class=\"hljs-title\">run</span>(<span class=\"hljs-params\">\n    [<span class=\"hljs-string\">'ls'</span>]\n</span>)\n\n<span class=\"hljs-title\">print</span>(<span class=\"hljs-params\">res</span>)</span></code></pre>\n<p>この実行結果は以下になります。</p>\n<pre><code class=\"hljs language-bash\">CompletedProcess(args=[<span class=\"hljs-string\">'ls'</span>], returncode=0)</code></pre>\n<p>特段注意すべきは、コマンドをリスト又はタプルで入力することでしょうか。基本的にスペースを入れることはできません。引数やフラグを足す際に、スペースが必要ならば、リストやタプルにカンマ(,)で区切りましょう。</p>\n<p>と言いますか...ん？？</p>\n<p>ディレクトリ群出てこないんですけど...<br>\nというのも、あくまで返ってくるのは<strong>subprocess.CompletedProcess</strong>クラスだからですね。</p>\n<h2>CompletedProcessをいじってみる</h2>\n<p>実行出来たはずなのに、結果が帰って来ないようじゃ意味がないので中身を開けていきましょう。</p>\n<p>CompletedProcessクラスには以下のメソッドや変数が存在しています。</p>\n<ul>\n<li>.args</li>\n<li>.returncode</li>\n<li>.stdout</li>\n<li>.check_returncode()</li>\n<li>.stderr</li>\n</ul>\n<p>これから先のチェックは、さきのプログラムの続き。returnされたものは<em>res</em>に入っている。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">print</span>(res.args)\n<span class=\"hljs-comment\"># >>> ['ls']</span>\n\n<span class=\"hljs-built_in\">print</span>(res.returncode)\n<span class=\"hljs-comment\"># >>> 0</span>\n\n<span class=\"hljs-built_in\">print</span>(res.stdout)\n<span class=\"hljs-comment\"># >>> None</span>\n\n<span class=\"hljs-built_in\">print</span>(res.stderr)\n<span class=\"hljs-comment\"># >>> None</span></code></pre>\n<p>という結果に...</p>\n<p>プログラムが期待通り終了した場合、0が返ってきます。</p>\n<p>ただ、標準出力、標準エラーには<em>None</em>が返ってきていますね。どこにも結果がないのだけど...</p>\n<h2>実行結果をみる!!</h2>\n<p>実は、subprocess.run()には、出力をキャプチャする引数があったみたいです。それが<strong>capture_output</strong>。これをTrueにすると出力が保存されます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> subprocess\n\nres = subprocess.&#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">function</span>\"><span class=\"hljs-title\">run</span>(<span class=\"hljs-params\">[<span class=\"hljs-string\">'ls'</span>], capture_output=<span class=\"hljs-literal\">True</span></span>)\n\n<span class=\"hljs-title\">print</span>(<span class=\"hljs-params\">res</span>)\n# >>> <span class=\"hljs-title\">CompletedProcess</span>(<span class=\"hljs-params\">args=[<span class=\"hljs-string\">'ls'</span>], returncode=<span class=\"hljs-number\">0</span>,\nstdout=<span class=\"hljs-string\">b'Applications\\nLibrary\\nSystem\\nUsers\\nVolumes\\nbin\\ncores\\ndev\\netc\\nhome\\nopt\\nprivate\\nsbin\\ntmp\\nusr\\nvar\\n'</span>,\nstderr=<span class=\"hljs-string\">b''</span></span>)</span></code></pre>\n<p>これで出力をみることができました。</p>\n<p>他にもコマンドを使うことができるので、必要に応じてsubprocessモジュールを使ってみてください。</p>\n<p>今回はこれにて終了！</p>\n</section>\n","Title":"PythonからUNIXコマンド発出【ls編】","Date":"2020-11-10","Category":"Python","Tags":["Python","subprocess"],"Authors":"ゆうぼう","Slug":"ls-python","Thumbnail":"/images/thumbnails/python.jpg","Description":"PythonからUNIXコマンドを使いたい。そんな時があると思います!(多分滅多にないと思うけど)今回は、「ls」コマンドをPythonスクリプトから実行していこうと思います。","Published":true},{"contentHtml":"<p>FlaskからJSONを返してAPIサーバー風に稼働させていたのですが、なぜかfetchしたJavaScript側でエラーが...なんだこれとなったのですが、バックエンドのPython側のミスでした。何気に気付きにくかったりするので、またミスしたときのために備忘録として残しておきます。</p>\n<p>今回の環境がこちら</p>\n<ul>\n<li>Python-3.8.6</li>\n<li>Flask</li>\n</ul>\n<h2>エラー内容</h2>\n<p>今回起きたエラーがこちらです。</p>\n<pre><code class=\"hljs language-bash\">SyntaxError: Unexpected token o <span class=\"hljs-keyword\">in</span> JSON at position 1</code></pre>\n<p>予期せぬトークンが頭文字にあったらしいです。なんだこれ...<br>\n他の場所では特にエラーなかったのになぜここだけ...</p>\n<p>Pythonの方を確認してみます。</p>\n<h2>Pythonのミス</h2>\n<p>単にPythonのミスでした。ミスの部分だけピックアップします。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">@app.route(<span class=\"hljs-params\"><span class=\"hljs-string\">'/test'</span></span>)</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">test</span>():</span>\n    obj = {\n        <span class=\"hljs-string\">'foo'</span>: <span class=\"hljs-string\">'bar'</span>,\n    }\n    \n    <span class=\"hljs-keyword\">return</span> jsonify(obj)</code></pre>\n<p>何気にわかりにくいんです。</p>\n<p><strong>json.dumps()してなかった</strong>......</p>\n<p>めっちゃくだらないミスで萎えますねこれ。</p>\n<p>というわけで、<em>return jsonify</em>する前にしっかりdictをjsonにダンプしておきます。</p>\n<p>改良版が以下。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">@app.route(<span class=\"hljs-params\"><span class=\"hljs-string\">'/test'</span></span>)</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">test</span>():</span>\n    obj = {\n        <span class=\"hljs-string\">'foo'</span>: <span class=\"hljs-string\">'bar'</span>,\n    }\n    \n    obj = json.dumps(obj)\n    \n    <span class=\"hljs-keyword\">return</span> jsonify(obj) </code></pre>\n<p>これでもう、フロント側ではエラー起こさせません!!!!</p>\n<p>簡単に直るけど、気付きにくいってやつです。Flask使ってJSONで通信するときは、フロント側でエラーが出たら、JSONを送っているバックエンドも確認すると良いでしょう。</p>\n<p>今回はこれだけです!</p>\n","Title":"【Flask】フロントでUnexpected token!?","Date":"2020-11-08","Category":"Python","Tags":["Python","JSON","Flask"],"Authors":"ゆうぼう","Slug":"flask-json-parse-err","Thumbnail":"/images/thumbnails/python.jpg","Description":"FlaskからJSONを返してAPIサーバー風に稼働させていたのですが、なぜかfetchしたJavaScript側でエラーが...なんだこれとなったのですが、バックエンドのPython側のミスでした。何気に気付きにくかったりするので、またミスしたときのために備忘録として残しておきます。","Published":true},{"contentHtml":"<p>Anacondaは、GUIで操作ができてやりやすいですが、起動もかなりおそくCLIでどうにかならないか<strong>conda create</strong>コマンドを使って環境を立てる事があります。しかし、ノリでEnterを押してしまってPythonのバージョンを指定し忘れることが...。かなりの弊害を生み出します。その際の対処法を共有します。</p>\n<h2>CLIでconda環境を作る方法</h2>\n<p>まずは、CLIで環境を作るコマンドの紹介です。</p>\n<pre><code class=\"hljs language-bash\">conda create -n your-env-name python=3.x</code></pre>\n<p>たったこれだけで環境を建てられます。</p>\n<h2>あ、やってしまった...python=3.x忘れた</h2>\n<p>僕がノリでガガガってコマンド打って最後にやり忘れるやつです。</p>\n<p>押してから気付くのです...<br>\nあ、やってしまった...python=3.xって打つの忘れた...と</p>\n<pre><code class=\"hljs language-bash\">conda create -n your-env-name</code></pre>\n<p>これやっちゃうとすごく焦るんですよね。なんでかっていうとですね</p>\n<pre><code class=\"hljs language-bash\">(base)$ conda create -n typo\n(base)$ conda activate typo\n(typo)$ pip list\nTraceback (most recent call last):\n  File <span class=\"hljs-string\">\"/usr/local/bin/pip\"</span>, line 6, <span class=\"hljs-keyword\">in</span> &#x3C;module>\n    from pip._internal.cli.main import main\nModuleNotFoundError: No module named <span class=\"hljs-string\">'pip._internal.cli.main'</span></code></pre>\n<p><em>pipがない</em>...だと...!?</p>\n<p>これは困りました。。。しかもこの環境でやると、そこまで自分好みにカスタマイズしていない方は<em>python2</em>がデフォになっていると思います。</p>\n<p>いやぁ困った。</p>\n<h2>【解決策】condaにPythonをインストール</h2>\n<p>condaに<em>Pythonのバージョンを明示した上で</em>インストールすればうまくいきます！！！</p>\n<p>今回は、現状でAnacondaが対応している最新版の<em>Python3.8</em>をインストールします。</p>\n<pre><code class=\"hljs language-bash\">(typo)$ conda install python==3.8\nCollecting package metadata (current_repodata.json): <span class=\"hljs-keyword\">done</span>\nSolving environment: failed with initial frozen solve. Retrying with flexible solve.\nCollecting package metadata (repodata.json): <span class=\"hljs-keyword\">done</span>\nSolving environment: <span class=\"hljs-keyword\">done</span>\n\n<span class=\"hljs-comment\">## Package Plan ##</span>\n\n  environment location: /Users/slothyubo/opt/anaconda3/envs/blog-tweet\n\n  added / updated specs:\n    - python==3.8\n\n\nThe following packages will be downloaded:\n\n    package                    |            build\n    ---------------------------|-----------------\n    certifi-2020.6.20          |     pyhd3eb1b0_3         155 KB\n    libffi-3.2.1               |    h0a44026_1007          43 KB\n    python-3.8.0               |       h359304d_2        18.8 MB\n    ------------------------------------------------------------\n                                           Total:        19.0 MB\n\nThe following NEW packages will be INSTALLED:\n\n  ca-certificates    pkgs/main/osx-64::ca-certificates-2020.10.14-0\n  certifi            pkgs/main/noarch::certifi-2020.6.20-pyhd3eb1b0_3\n  libcxx             pkgs/main/osx-64::libcxx-10.0.0-1\n  libedit            pkgs/main/osx-64::libedit-3.1.20191231-h1de35cc_1\n  libffi             pkgs/main/osx-64::libffi-3.2.1-h0a44026_1007\n  ncurses            pkgs/main/osx-64::ncurses-6.2-h0a44026_1\n  openssl            pkgs/main/osx-64::openssl-1.1.1h-haf1e3a3_0\n  pip                pkgs/main/osx-64::pip-20.2.4-py38_0\n  python             pkgs/main/osx-64::python-3.8.0-h359304d_2\n  readline           pkgs/main/osx-64::readline-7.0-h1de35cc_5\n  setuptools         pkgs/main/osx-64::setuptools-50.3.0-py38h0dc7051_1\n  sqlite             pkgs/main/osx-64::sqlite-3.33.0-hffcf06c_0\n  tk                 pkgs/main/osx-64::tk-8.6.10-hb0a8c7a_0\n  wheel              pkgs/main/noarch::wheel-0.35.1-py_0\n  xz                 pkgs/main/osx-64::xz-5.2.5-h1de35cc_0\n  zlib               pkgs/main/osx-64::zlib-1.2.11-h1de35cc_3\n\n\nProceed ([y]/n)? y  <span class=\"hljs-comment\"># &#x3C;== yでEnter</span>\n\nDownloading and Extracting Packages\npython-3.8.0         | 18.8 MB   | <span class=\"hljs-comment\">######################################################### | 100% </span>\nlibffi-3.2.1         | 43 KB     | <span class=\"hljs-comment\">######################################################### | 100% </span>\ncertifi-2020.6.20    | 155 KB    | <span class=\"hljs-comment\">######################################################### | 100% </span>\nPreparing transaction: <span class=\"hljs-keyword\">done</span>\nVerifying transaction: <span class=\"hljs-keyword\">done</span>\nExecuting transaction: <span class=\"hljs-keyword\">done</span></code></pre>\n<p>このようになり、インストールされました。</p>\n<p>また途中でpipも同時にインストールされており、これで無事にpipもインストールされるようになりました！</p>\n<p>確認</p>\n<pre><code class=\"hljs language-bash\">(typo)$ pip --version\npip 20.0.2 from /Users/user/opt/anaconda3/envs/static-site/lib/python3.7/site-packages/pip (python 3.7)</code></pre>\n<p>上記は人によりますが、しっかりpipが使えますね</p>\n<p>それでは、もし<strong>conda create</strong>でPythonのバージョンを書き忘れたら、これで解決しましょう！</p>\n","Title":"conda createでpythonのバージョン指定忘れた！","Date":"2020-11-01","Category":"Python","Tags":["Python","conda"],"Authors":"ゆうぼう","Slug":"conda-miss-pythonv","Thumbnail":"/images/thumbnails/python.jpg","Description":"Anacondaは、GUIで操作ができてやりやすいですが、起動もかなりおそくCLIでどうにかならないか「conda create」コマンドを使って環境を立てる事があります。しかし、ノリでEnterを押してしまってPythonのバージョンを指定し忘れることが...。かなりの弊害を生み出します。その際の対処法を共有します。","Published":true},{"contentHtml":"<p>Pythonにも<strong>map関数</strong>があり、容易に配列から新たな配列を生み出すことができます。<em>lambda</em>を用いて無名関数を使うなど、いくつか応用方があるので備忘録がてらまとめていこうと思います。</p>\n<p>簡単のため、<em>ある配列の全ての要素の絶対値をとる</em>スクリプトで試します。</p>\n<h2>mapと無名関数</h2>\n<p>新たに配列から配列を作るために忘れてはいけないのは、<strong>mapオブジェクトをlistで囲むこと</strong>です。</p>\n<p>その点を考慮しつつ、新たな配列を生み出していきます。まずは、無名関数<em>lambda</em>を使います。</p>\n<pre><code class=\"hljs language-python\">a = [-<span class=\"hljs-number\">3</span>, -<span class=\"hljs-number\">2</span>, -<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>]\nto_abs = <span class=\"hljs-keyword\">lambda</span> x: <span class=\"hljs-built_in\">abs</span>(x)\n\nb = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">map</span>(to_abs, a))\n<span class=\"hljs-built_in\">print</span>(b)</code></pre>\n<pre><code class=\"hljs language-bash\">[3, 2, 1, 0, 1, 2, 3]</code></pre>\n<p>無名関数<em>to_abs</em>により、渡される各関数の値の絶対値を返します。</p>\n<h2>mapと普段使いの関数</h2>\n<p>普段通りの関数宣言でも動きます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">to_abs</span>(<span class=\"hljs-params\">x</span>):</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">abs</span>(x)\n    \nc = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">map</span>(to_abs, a))\n<span class=\"hljs-built_in\">print</span>(c)</code></pre>\n<pre><code class=\"hljs language-bash\">[3, 2, 1, 0, 1, 2, 3]</code></pre>\n<p>普通に動きますが、ここで注意したいのは<strong>mapに渡す関数に直接的に引数を与えないこと</strong>です。</p>\n<p>そうすることで難なく動きます。</p>\n<p>引数を渡してみるとどうなるでしょうか。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">to_abs</span>(<span class=\"hljs-params\">x</span>):</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">abs</span>(x)\n    \nc = <span class=\"hljs-built_in\">list</span>(<span class=\"hljs-built_in\">map</span>(to_abs(x), a))\n<span class=\"hljs-built_in\">print</span>(c)</code></pre>\n<pre><code class=\"hljs language-bash\">Traceback (most recent call last):\n  File <span class=\"hljs-string\">\"map.py\"</span>, line 3, <span class=\"hljs-keyword\">in</span> &#x3C;module>\n    c = list(map(to_abs(x), a))\nNameError: name <span class=\"hljs-string\">'x'</span> is not defined</code></pre>\n<p>参照する<em>x</em>がないのでエラーが発生します。その点だけ注意しましょう。</p>\n<h2>mapでsetに応用</h2>\n<p>setについても同様に動作します</p>\n<pre><code class=\"hljs language-python\">d = <span class=\"hljs-built_in\">set</span>(<span class=\"hljs-built_in\">map</span>(to_abs, a))\n<span class=\"hljs-built_in\">print</span>(d)</code></pre>\n<pre><code class=\"hljs language-bash\">{0, 1, 2, 3}</code></pre>\n<p>しっかりと集合として捉えられていますね。</p>\n<p>mapを使ってさせることはそこまで難しくないですが、処理速度的にはおそらく内包表記の方が速いと思われるので場合に合わせて導入するのが良いかもしれません。</p>\n<p>ただ、numpyやpandasでデータ分析をする際は、map関数がそれぞれで与えられていることもあるので、使えるに越したことはないでしょう。</p>\n","Title":"【map】を使って新たな配列を作る","Date":"2020-10-26","Category":"Python","Tags":["Python","map"],"Authors":"ゆうぼう","Slug":"py-map","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonにもmap関数があり、容易に配列から新たな配列を生み出すことができます。lambdaを用いて無名関数を使うなど、いくつか応用方があるので備忘録がてらまとめていこうと思います。","Published":true},{"contentHtml":"<p>Pythonには<strong>デコレータ</strong>というものがあるのですが、意外と初学者には知られていない存在で比較的不思議な挙動をする感じがします。関数を直接的に実行しなくともファイルを読み込んだ段階で実行されるようなので、挙動について実験してみました。</p>\n<h2>デコレータ活用例</h2>\n<p>まずは、デコレータの活用例をお話しします。(Numpyから借用)</p>\n<p>Numpyにおいては、関数のモジュールを<em>numpy</em>に変更しており、override.pyか_override.pyだかに<em>set_module</em>関数が作られていたと思います(ちょっと曖昧)</p>\n<p>適当な関数を定義してモジュールを変更します。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">set_module</span>(<span class=\"hljs-params\">name</span>):</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">decorator</span>(<span class=\"hljs-params\">func</span>):</span>\n        func.__module__ = name\n        <span class=\"hljs-keyword\">return</span> func\n    <span class=\"hljs-keyword\">return</span> decorator\n    \n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">check_module</span>(<span class=\"hljs-params\">func</span>):</span>\n    <span class=\"hljs-built_in\">print</span>(func.__module__)\n    \n<span class=\"hljs-meta\">@set_module(<span class=\"hljs-params\"><span class=\"hljs-string\">'mylib'</span></span>)    </span><span class=\"hljs-comment\"># module名書き換え</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">changed</span>():</span>\n    <span class=\"hljs-keyword\">pass</span>\n    \n<span class=\"hljs-comment\"># module名変更なし</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">not_changed</span>():</span>\n    <span class=\"hljs-keyword\">pass</span>\n    \n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">'__main__'</span>:\n    check_module(changed)\n    check_module(not_changed)</code></pre>\n<p>各関数の役割</p>\n<ul>\n<li>set_module\n<ul>\n<li>デコレータ</li>\n<li>関数のモジュール名を変更する</li>\n</ul>\n</li>\n<li>changed\n<ul>\n<li>モジュール名を変更される関数</li>\n</ul>\n</li>\n<li>not_changed\n<ul>\n<li>モジュール名を<strong>変更されない</strong>関数</li>\n</ul>\n</li>\n</ul>\n<p>これらの実行結果が以下になります。</p>\n<pre><code class=\"hljs language-bash\">mylib\n__main__</code></pre>\n<p>変更された方は、期待した通りモジュール名が<em>mylib</em>に変わっていて、変更していない方はメインルーティンに入っていることになっています。</p>\n<h2>デコレータの挙動を追う</h2>\n<p>デコレータの挙動を追ってみます。基本的には動作がわかるように関数に機能はつけず、標準出力にて動作を確認していきます。</p>\n<p>実験するための関数を用意します。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">deco</span>(<span class=\"hljs-params\">name</span>):</span>\n    <span class=\"hljs-built_in\">print</span>(name, <span class=\"hljs-string\">'開始'</span>)\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">decorator</span>(<span class=\"hljs-params\">func</span>):</span>\n        <span class=\"hljs-built_in\">print</span>(func.__name__, <span class=\"hljs-string\">'実行'</span>)\n        <span class=\"hljs-keyword\">return</span> func\n    <span class=\"hljs-built_in\">print</span>(name, <span class=\"hljs-string\">'終了'</span>)\n    <span class=\"hljs-keyword\">return</span> decorator\n    \n<span class=\"hljs-meta\">@deco(<span class=\"hljs-params\"><span class=\"hljs-string\">'deco1'</span></span>)</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">test1</span>():</span>\n    <span class=\"hljs-keyword\">pass</span>\n    \n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    <span class=\"hljs-keyword\">pass</span></code></pre>\n<p>特別難しいこともありません。ただ各タイミングで出力を待つデコレータです。</p>\n<p>実行結果が以下になります。</p>\n<pre><code class=\"hljs language-bash\">deco1 開始\ndeco1 終了\ntest1 実行</code></pre>\n<p>デコレータの外の関数を動かした後、デコレートされた(装飾された)関数が返されるという感じです。</p>\n<p>流れは以下になります。</p>\n<ol>\n<li>デコレータの発火</li>\n<li>デコレータにより関数を装飾</li>\n<li>装飾された関数が返ってくる</li>\n<li>あとは3の関数を使うだけ</li>\n</ol>\n<p>このような流れになっていきます。デコレータは関数を装飾するものなので、ちょっと特殊であまり使うことがない気もしますが...</p>\n<p>また、<strong>メインルーティンで何も動かしていないのにもかかわらず</strong>、出力されています。</p>\n<p>デコレータは読み込んだときに動くようです。その特徴がわかればそこまでデコレータは難しいものでもなさそうです。</p>\n<p>あとでまた多重デコレータに関する話をしたいと思います。</p>\n","Title":"Pythonのデコレータの挙動を実験してみた","Date":"2020-10-26","Category":"Python","Tags":["Python","デコレータ"],"Authors":"ゆうぼう","Slug":"decorator-timing","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonにはデコレータというものがあるのですが、意外と初学者には知られていない存在で比較的不思議な挙動をする感じがします。関数を直接的に実行しなくともファイルを読み込んだ段階で実行されるようなので、挙動について実験してみました。","Published":true},{"contentHtml":"<p>Pythonを使って、例えばコーパスを作る際、辞書型に対して単語出現回数を記録しするなど、辞書を使うことがあるかもしれません。その際、ifによる条件分岐によって辞書型の初期化をするわけですが、collectionsにあるdefaultdictというものを使うと初期化を勝手にやってくれます。そのdefaultdictについて解説していきます。</p>\n<p>今回は、Wikipediaの「AI」に関するページの一部文章に関して単語出現回数を数えていきます。</p>\n<h2>文章を単語ごとに分割する</h2>\n<p>まずは手始めに文章を単語ごとに分割していきます。</p>\n<p>使用する文章がこちらです。</p>\n<p>Artificial intelligence (AI), is intelligence demonstrated by machines, unlike the natural intelligence displayed by humans and animals. Leading AI textbooks define the field as the study of \"intelligent agents\": any device that perceives its environment and takes actions that maximize its chance of successfully achieving its goals. Colloquially, the term \"artificial intelligence\" is often used to describe machines (or computers) that mimic \"cognitive\" functions that humans associate with the human mind, such as \"learning\" and \"problem solving\".</p>\n<p>As machines become increasingly capable, tasks considered to require \"intelligence\" are often removed from the definition of AI, a phenomenon known as the AI effect. A quip in Tesler's Theorem says \"AI is whatever hasn't been done yet.\" For instance, optical character recognition is frequently excluded from things considered to be AI, having become a routine technology. Modern machine capabilities generally classified as AI include successfully understanding human speech, competing at the highest level in strategic game systems (such as chess and Go), autonomously operating cars, intelligent routing in content delivery networks, and military simulations.</p>\n<p>Artificial intelligence was founded as an academic discipline in 1955, and in the years since has experienced several waves of optimism, followed by disappointment and the loss of funding (known as an \"AI winter\"), followed by new approaches, success and renewed funding. For most of its history, AI research has been divided into sub-fields that often fail to communicate with each other. These sub-fields are based on technical considerations, such as particular goals (e.g. \"robotics\" or \"machine learning\"), the use of particular tools (\"logic\" or artificial neural networks), or deep philosophical differences. Sub-fields have also been based on social factors (particular institutions or the work of particular researchers).</p>\n<p>The traditional problems (or goals) of AI research include reasoning, knowledge representation, planning, learning, natural language processing, perception and the ability to move and manipulate objects. General intelligence is among the field's long-term goals. Approaches include statistical methods, computational intelligence, and traditional symbolic AI. Many tools are used in AI, including versions of search and mathematical optimization, artificial neural networks, and methods based on statistics, probability and economics. The AI field draws upon computer science, information engineering, mathematics, psychology, linguistics, philosophy, and many other fields.</p>\n<p>The field was founded on the assumption that human intelligence \"can be so precisely described that a machine can be made to simulate it\". This raises philosophical arguments about the mind and the ethics of creating artificial beings endowed with human-like intelligence. These issues have been explored by myth, fiction and philosophy since antiquity. Some people also consider AI to be a danger to humanity if it progresses unabated. Others believe that AI, unlike previous technological revolutions, will create a risk of mass unemployment.</p>\n<p>In the twenty-first century, AI techniques have experienced a resurgence following concurrent advances in computer power, large amounts of data, and theoretical understanding; and AI techniques have become an essential part of the technology industry, helping to solve many challenging problems in computer science, software engineering and operations research.</p>\n<p>こちらを分割します。</p>\n<p><em>content</em>という変数に上記の文章が入っていることを想定しています。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> re\nwords = re.split(<span class=\"hljs-string\">'[,\\.\"\\(\\)\\s+]'</span>, content)\nwords = [word <span class=\"hljs-keyword\">for</span> word <span class=\"hljs-keyword\">in</span> words <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> word==<span class=\"hljs-string\">''</span>]</code></pre>\n<p>1行目で「, . \" ( ) 空白」を区切りとして単語分けしています。これで空白が取り切れないので、2行目で空文字になってしまったものを削除します。</p>\n<h2>初期化をサボってカウントする</h2>\n<p>それでは初期化をサボって単語出現回数をカウントしていきます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> collections <span class=\"hljs-keyword\">import</span> defaultdict\n\nfreq = defaultdict(<span class=\"hljs-built_in\">int</span>)\n<span class=\"hljs-keyword\">for</span> word <span class=\"hljs-keyword\">in</span> words:\n     freq[word] += <span class=\"hljs-number\">1</span></code></pre>\n<p>たったこれでだけで、ifによる条件分岐なしにカウントができます。結果をみてみてもしっかりカウントされていることがわかります。</p>\n<pre><code class=\"hljs language-python\">&#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">builtins</span>\"><span class=\"hljs-title\">print</span>(<span class=\"hljs-params\">freq</span>)\n</span></code></pre>\n<pre><code class=\"hljs language-bash\">defaultdict(&#x3C;\\class <span class=\"hljs-string\">'int'</span>>, {<span class=\"hljs-string\">'Artificial'</span>: 2, <span class=\"hljs-string\">'intelligence'</span>: 10, <span class=\"hljs-string\">'AI'</span>: 17, <span class=\"hljs-string\">'is'</span>: 5, <span class=\"hljs-string\">'demonstrated'</span>: 1, <span class=\"hljs-string\">'by'</span>: 5, <span class=\"hljs-string\">'machines'</span>: 3, <span class=\"hljs-string\">'unlike'</span>: 2,\n<span class=\"hljs-string\">'the'</span>: 19, <span class=\"hljs-string\">'natural'</span>: 2, <span class=\"hljs-string\">'displayed'</span>: 1, <span class=\"hljs-string\">'humans'</span>: 2, <span class=\"hljs-string\">'and'</span>: 20, <span class=\"hljs-string\">'animals'</span>: 1, <span class=\"hljs-string\">'Leading'</span>: 1, <span class=\"hljs-string\">'textbooks'</span>: 1, <span class=\"hljs-string\">'define'</span>: 1, <span class=\"hljs-string\">'field'</span>: 3, <span class=\"hljs-string\">'as'</span>:\n8, <span class=\"hljs-string\">'study'</span>: 1, <span class=\"hljs-string\">'of'</span>: 14, <span class=\"hljs-string\">'intelligent'</span>: 2, <span class=\"hljs-string\">'agents'</span>: 1, <span class=\"hljs-string\">':'</span>: 1, <span class=\"hljs-string\">'any'</span>: 1, <span class=\"hljs-string\">'device'</span>: 1, <span class=\"hljs-string\">'that'</span>: 8, <span class=\"hljs-string\">'perceives'</span>: 1, <span class=\"hljs-string\">'its'</span>: 4, <span class=\"hljs-string\">'environment'</span>:\n1, <span class=\"hljs-string\">'takes'</span>: 1, <span class=\"hljs-string\">'actions'</span>: 1, <span class=\"hljs-string\">'maximize'</span>: 1, <span class=\"hljs-string\">'chance'</span>: 1, <span class=\"hljs-string\">'successfully'</span>: 2, <span class=\"hljs-string\">'achieving'</span>: 1, <span class=\"hljs-string\">'goals'</span>: 4, <span class=\"hljs-string\">'Colloquially'</span>: 1, <span class=\"hljs-string\">'term'</span>: 1,\n<span class=\"hljs-string\">'artificial'</span>: 4, <span class=\"hljs-string\">'often'</span>: 3, <span class=\"hljs-string\">'used'</span>: 2, <span class=\"hljs-string\">'to'</span>: 9, <span class=\"hljs-string\">'describe'</span>: 1, <span class=\"hljs-string\">'or'</span>: 6, <span class=\"hljs-string\">'computers'</span>: 1, <span class=\"hljs-string\">'mimic'</span>: 1, <span class=\"hljs-string\">'cognitive'</span>: 1, <span class=\"hljs-string\">'functions'</span>: 1,\n<span class=\"hljs-string\">'associate'</span>: 1, <span class=\"hljs-string\">'with'</span>: 3, <span class=\"hljs-string\">'human'</span>: 3, <span class=\"hljs-string\">'mind'</span>: 2, <span class=\"hljs-string\">'such'</span>: 3, <span class=\"hljs-string\">'learning'</span>: 3, <span class=\"hljs-string\">'problem'</span>: 1, <span class=\"hljs-string\">'solving'</span>: 1, <span class=\"hljs-string\">'As'</span>: 1, <span class=\"hljs-string\">'become'</span>: 3,\n<span class=\"hljs-string\">'increasingly'</span>: 1, <span class=\"hljs-string\">'capable'</span>: 1, <span class=\"hljs-string\">'tasks'</span>: 1, <span class=\"hljs-string\">'considered'</span>: 2, <span class=\"hljs-string\">'require'</span>: 1, <span class=\"hljs-string\">'are'</span>: 3, <span class=\"hljs-string\">'removed'</span>: 1, <span class=\"hljs-string\">'from'</span>: 2, <span class=\"hljs-string\">'definition'</span>: 1, <span class=\"hljs-string\">'a'</span>:\n6, <span class=\"hljs-string\">'phenomenon'</span>: 1, <span class=\"hljs-string\">'known'</span>: 2, <span class=\"hljs-string\">'effect'</span>: 1, <span class=\"hljs-string\">'A'</span>: 1, <span class=\"hljs-string\">'quip'</span>: 1, <span class=\"hljs-string\">'in'</span>: 8, <span class=\"hljs-string\">\"Tesler's\"</span>: 1, <span class=\"hljs-string\">'Theorem'</span>: 1, <span class=\"hljs-string\">'says'</span>: 1, <span class=\"hljs-string\">'whatever'</span>: 1,\n<span class=\"hljs-string\">\"hasn't\"</span>: 1, <span class=\"hljs-string\">'been'</span>: 4, <span class=\"hljs-string\">'done'</span>: 1, <span class=\"hljs-string\">'yet'</span>: 1, <span class=\"hljs-string\">'For'</span>: 2, <span class=\"hljs-string\">'instance'</span>: 1, <span class=\"hljs-string\">'optical'</span>: 1, <span class=\"hljs-string\">'character'</span>: 1, <span class=\"hljs-string\">'recognition'</span>: 1, <span class=\"hljs-string\">'frequently'</span>:\n1, <span class=\"hljs-string\">'excluded'</span>: 1, <span class=\"hljs-string\">'things'</span>: 1, <span class=\"hljs-string\">'be'</span>: 4, <span class=\"hljs-string\">'having'</span>: 1, <span class=\"hljs-string\">'routine'</span>: 1, <span class=\"hljs-string\">'technology'</span>: 2, <span class=\"hljs-string\">'Modern'</span>: 1, <span class=\"hljs-string\">'machine'</span>: 3, <span class=\"hljs-string\">'capabilities'</span>: 1,\n<span class=\"hljs-string\">'generally'</span>: 1, <span class=\"hljs-string\">'classified'</span>: 1, <span class=\"hljs-string\">'include'</span>: 3, <span class=\"hljs-string\">'understanding'</span>: 1, <span class=\"hljs-string\">'speech'</span>: 1, <span class=\"hljs-string\">'competing'</span>: 1, <span class=\"hljs-string\">'at'</span>: 1, <span class=\"hljs-string\">'highest'</span>: 1, <span class=\"hljs-string\">'level'</span>: 1,\n<span class=\"hljs-string\">'strategic'</span>: 1, <span class=\"hljs-string\">'game'</span>: 1, <span class=\"hljs-string\">'systems'</span>: 1, <span class=\"hljs-string\">'chess'</span>: 1, <span class=\"hljs-string\">'Go'</span>: 1, <span class=\"hljs-string\">'autonomously'</span>: 1, <span class=\"hljs-string\">'operating'</span>: 1, <span class=\"hljs-string\">'cars'</span>: 1, <span class=\"hljs-string\">'routing'</span>: 1,\n<span class=\"hljs-string\">'content'</span>: 1, <span class=\"hljs-string\">'delivery'</span>: 1, <span class=\"hljs-string\">'networks'</span>: 3, <span class=\"hljs-string\">'military'</span>: 1, <span class=\"hljs-string\">'simulations'</span>: 1, <span class=\"hljs-string\">'was'</span>: 2, <span class=\"hljs-string\">'founded'</span>: 2, <span class=\"hljs-string\">'an'</span>: 3, <span class=\"hljs-string\">'academic'</span>: 1,\n<span class=\"hljs-string\">'discipline'</span>: 1, <span class=\"hljs-string\">'1955'</span>: 1, <span class=\"hljs-string\">'years'</span>: 1, <span class=\"hljs-string\">'since'</span>: 2, <span class=\"hljs-string\">'has'</span>: 2, <span class=\"hljs-string\">'experienced'</span>: 2, <span class=\"hljs-string\">'several'</span>: 1, <span class=\"hljs-string\">'waves'</span>: 1, <span class=\"hljs-string\">'optimism'</span>: 1,\n<span class=\"hljs-string\">'followed'</span>: 2, <span class=\"hljs-string\">'disappointment'</span>: 1, <span class=\"hljs-string\">'loss'</span>: 1, <span class=\"hljs-string\">'funding'</span>: 2, <span class=\"hljs-string\">'winter'</span>: 1, <span class=\"hljs-string\">'new'</span>: 1, <span class=\"hljs-string\">'approaches'</span>: 1, <span class=\"hljs-string\">'success'</span>: 1, <span class=\"hljs-string\">'renewed'</span>:\n1, <span class=\"hljs-string\">'most'</span>: 1, <span class=\"hljs-string\">'history'</span>: 1, <span class=\"hljs-string\">'research'</span>: 3, <span class=\"hljs-string\">'divided'</span>: 1, <span class=\"hljs-string\">'into'</span>: 1, <span class=\"hljs-string\">'sub-fields'</span>: 2, <span class=\"hljs-string\">'fail'</span>: 1, <span class=\"hljs-string\">'communicate'</span>: 1, <span class=\"hljs-string\">'each'</span>: 1,\n<span class=\"hljs-string\">'other'</span>: 2, <span class=\"hljs-string\">'These'</span>: 2, <span class=\"hljs-string\">'based'</span>: 3, <span class=\"hljs-string\">'on'</span>: 4, <span class=\"hljs-string\">'technical'</span>: 1, <span class=\"hljs-string\">'considerations'</span>: 1, <span class=\"hljs-string\">'particular'</span>: 4, <span class=\"hljs-string\">'e'</span>: 1, <span class=\"hljs-string\">'g'</span>: 1,\n<span class=\"hljs-string\">'robotics'</span>: 1, <span class=\"hljs-string\">'use'</span>: 1, <span class=\"hljs-string\">'tools'</span>: 2, <span class=\"hljs-string\">'logic'</span>: 1, <span class=\"hljs-string\">'neural'</span>: 2, <span class=\"hljs-string\">'deep'</span>: 1, <span class=\"hljs-string\">'philosophical'</span>: 2, <span class=\"hljs-string\">'differences'</span>: 1,\n<span class=\"hljs-string\">'Sub-fields'</span>: 1, <span class=\"hljs-string\">'have'</span>: 4, <span class=\"hljs-string\">'also'</span>: 2, <span class=\"hljs-string\">'social'</span>: 1, <span class=\"hljs-string\">'factors'</span>: 1, <span class=\"hljs-string\">'institutions'</span>: 1, <span class=\"hljs-string\">'work'</span>: 1, <span class=\"hljs-string\">'researchers'</span>: 1, <span class=\"hljs-string\">'The'</span>:\n3, <span class=\"hljs-string\">'traditional'</span>: 2, <span class=\"hljs-string\">'problems'</span>: 2, <span class=\"hljs-string\">'reasoning'</span>: 1, <span class=\"hljs-string\">'knowledge'</span>: 1, <span class=\"hljs-string\">'representation'</span>: 1, <span class=\"hljs-string\">'planning'</span>: 1, <span class=\"hljs-string\">'language'</span>: 1,\n<span class=\"hljs-string\">'processing'</span>: 1, <span class=\"hljs-string\">'perception'</span>: 1, <span class=\"hljs-string\">'ability'</span>: 1, <span class=\"hljs-string\">'move'</span>: 1, <span class=\"hljs-string\">'manipulate'</span>: 1, <span class=\"hljs-string\">'objects'</span>: 1, <span class=\"hljs-string\">'General'</span>: 1, <span class=\"hljs-string\">'among'</span>: 1,\n<span class=\"hljs-string\">\"field's\"</span>: 1, <span class=\"hljs-string\">'long-term'</span>: 1, <span class=\"hljs-string\">'Approaches'</span>: 1, <span class=\"hljs-string\">'statistical'</span>: 1, <span class=\"hljs-string\">'methods'</span>: 2, <span class=\"hljs-string\">'computational'</span>: 1, <span class=\"hljs-string\">'symbolic'</span>: 1,\n<span class=\"hljs-string\">'Many'</span>: 1, <span class=\"hljs-string\">'including'</span>: 1, <span class=\"hljs-string\">'versions'</span>: 1, <span class=\"hljs-string\">'search'</span>: 1, <span class=\"hljs-string\">'mathematical'</span>: 1, <span class=\"hljs-string\">'optimization'</span>: 1, <span class=\"hljs-string\">'statistics'</span>: 1,\n<span class=\"hljs-string\">'probability'</span>: 1, <span class=\"hljs-string\">'economics'</span>: 1, <span class=\"hljs-string\">'draws'</span>: 1, <span class=\"hljs-string\">'upon'</span>: 1, <span class=\"hljs-string\">'computer'</span>: 3, <span class=\"hljs-string\">'science'</span>: 2, <span class=\"hljs-string\">'information'</span>: 1,\n<span class=\"hljs-string\">'engineering'</span>: 2, <span class=\"hljs-string\">'mathematics'</span>: 1, <span class=\"hljs-string\">'psychology'</span>: 1, <span class=\"hljs-string\">'linguistics'</span>: 1, <span class=\"hljs-string\">'philosophy'</span>: 2, <span class=\"hljs-string\">'many'</span>: 2, <span class=\"hljs-string\">'fields'</span>: 1,\n<span class=\"hljs-string\">'assumption'</span>: 1, <span class=\"hljs-string\">'can'</span>: 2, <span class=\"hljs-string\">'so'</span>: 1, <span class=\"hljs-string\">'precisely'</span>: 1, <span class=\"hljs-string\">'described'</span>: 1, <span class=\"hljs-string\">'made'</span>: 1, <span class=\"hljs-string\">'simulate'</span>: 1, <span class=\"hljs-string\">'it'</span>: 2, <span class=\"hljs-string\">'This'</span>: 1,\n<span class=\"hljs-string\">'raises'</span>: 1, <span class=\"hljs-string\">'arguments'</span>: 1, <span class=\"hljs-string\">'about'</span>: 1, <span class=\"hljs-string\">'ethics'</span>: 1, <span class=\"hljs-string\">'creating'</span>: 1, <span class=\"hljs-string\">'beings'</span>: 1, <span class=\"hljs-string\">'endowed'</span>: 1, <span class=\"hljs-string\">'human-like'</span>: 1,\n<span class=\"hljs-string\">'issues'</span>: 1, <span class=\"hljs-string\">'explored'</span>: 1, <span class=\"hljs-string\">'myth'</span>: 1, <span class=\"hljs-string\">'fiction'</span>: 1, <span class=\"hljs-string\">'antiquity'</span>: 1, <span class=\"hljs-string\">'Some'</span>: 1, <span class=\"hljs-string\">'people'</span>: 1, <span class=\"hljs-string\">'consider'</span>: 1,\n<span class=\"hljs-string\">'danger'</span>: 1, <span class=\"hljs-string\">'humanity'</span>: 1, <span class=\"hljs-string\">'if'</span>: 1, <span class=\"hljs-string\">'progresses'</span>: 1, <span class=\"hljs-string\">'unabated'</span>: 1, <span class=\"hljs-string\">'Others'</span>: 1, <span class=\"hljs-string\">'believe'</span>: 1, <span class=\"hljs-string\">'previous'</span>: 1,\n<span class=\"hljs-string\">'technological'</span>: 1, <span class=\"hljs-string\">'revolutions'</span>: 1, <span class=\"hljs-string\">'will'</span>: 1, <span class=\"hljs-string\">'create'</span>: 1, <span class=\"hljs-string\">'risk'</span>: 1, <span class=\"hljs-string\">'mass'</span>: 1, <span class=\"hljs-string\">'unemployment'</span>: 1, <span class=\"hljs-string\">'In'</span>: 1,\n<span class=\"hljs-string\">'twenty-first'</span>: 1, <span class=\"hljs-string\">'century'</span>: 1, <span class=\"hljs-string\">'techniques'</span>: 2, <span class=\"hljs-string\">'resurgence'</span>: 1, <span class=\"hljs-string\">'following'</span>: 1, <span class=\"hljs-string\">'concurrent'</span>: 1,\n<span class=\"hljs-string\">'advances'</span>: 1, <span class=\"hljs-string\">'power'</span>: 1, <span class=\"hljs-string\">'large'</span>: 1, <span class=\"hljs-string\">'amounts'</span>: 1, <span class=\"hljs-string\">'data'</span>: 1, <span class=\"hljs-string\">'theoretical'</span>: 1, <span class=\"hljs-string\">'understanding;'</span>: 1,\n<span class=\"hljs-string\">'essential'</span>: 1, <span class=\"hljs-string\">'part'</span>: 1, <span class=\"hljs-string\">'industry'</span>: 1, <span class=\"hljs-string\">'helping'</span>: 1, <span class=\"hljs-string\">'solve'</span>: 1, <span class=\"hljs-string\">'challenging'</span>: 1, <span class=\"hljs-string\">'software'</span>: 1,\n<span class=\"hljs-string\">'operations'</span>: 1})</code></pre>\n<p>これで簡単に単語数カウントができます。</p>\n<p>今回は単語数カウントを題材にしましたが、違う初期化方法を指定してあげれば他のことも可能になりますで試してみては。</p>\n","Title":"【defaultdict】で辞書型の初期化をサボる","Date":"2020-10-19","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"defaultdict-usage","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonを使って、例えばコーパスを作る際、辞書型に対して単語出現回数を記録しするなど、辞書を使うことがあるかもしれません。その際、ifによる条件分岐によって辞書型の初期化をするわけですが、collectionsにあるdefaultdictというものを使うと初期化を勝手にやってくれます。そのdefaultdictについて解説していきます。","Published":true},{"contentHtml":"<p>Pythonで中身をpopで削除したいなーと思った時、なぜか「<em>dictionary changed size during iteration</em>」とのメッセージが。これは意外と出てきたら原因がパッとしないので、2度と同じことを起こさないように記録しておきます。</p>\n<h2>直感的にイテレーションしてpopしていく</h2>\n<p>ここでは、直感的に初心者が思いつきそうな感じのイテレーションを用いてループを回し、popで辞書を消していきます。</p>\n<pre><code class=\"hljs language-python\">dictionary = {\n    <span class=\"hljs-string\">'a'</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">'b'</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">'c'</span>: <span class=\"hljs-number\">2</span>,\n}\n\n<span class=\"hljs-keyword\">for</span> key <span class=\"hljs-keyword\">in</span> dictionary.keys():\n    dictionary.pop(key)</code></pre>\n<p>結果はこんな感じに...</p>\n<pre><code class=\"hljs language-bash\">Traceback (most recent call last):\n  File <span class=\"hljs-string\">\"&#x3C;stdin>\"</span>, line 6, <span class=\"hljs-keyword\">in</span> &#x3C;module>\nRuntimeError: dictionary changed size during iteration</code></pre>\n<p>は？<em>RuntimeError</em>だと...!?</p>\n<p><strong>イテレーション中に辞書のサイズ変わったんですけど</strong>と怒られたわけです。</p>\n<p>ということは、<strong>keys()を使っていながら、ループの内部で辞書をいじってはいけない</strong>ということになりますね。</p>\n<h2>keys()をリストとして先に確保してしまえ!!</h2>\n<p>さて、解決していきます。</p>\n<p>イテレーション中の辞書を書き換えてはいけなかったので、*list()*にしてしまお〜〜<br>\nということで、キーのイテレータは配列として別物と扱わせます。</p>\n<p>少しだけ変えた奴が下。</p>\n<pre><code class=\"hljs language-python\">dictionary = {\n    <span class=\"hljs-string\">'a'</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">'b'</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">'c'</span>: <span class=\"hljs-number\">2</span>,\n}\n\n<span class=\"hljs-keyword\">for</span> key <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">list</span>(dictionary.keys()):    &#x3C;=変えるのはここ\n    dictionary.pop(key)</code></pre>\n<p>これで、出力も足してみます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">print</span>(a)</code></pre>\n<p>結果が以下になります。</p>\n<pre><code class=\"hljs language-bash\">1</code></pre>\n<p>お〜動きましたね。</p>\n<p>というわけで、辞書型でイテレーションを用いて何かするときは、配列とかで切り離して使ってあげるとエラーなくコードが動きますよ〜</p>\n<p>今後は僕も気をつけたいと思います。</p>\n","Title":"dictionary changed size during iterationの原因特定した","Date":"2020-10-18","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"py-dict-iter-err","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonで中身をpopで削除したいなーと思った時、なぜか「dictionary changed size during iteration」とのメッセージが。これは意外と出てきたら原因がパッとしないので、2度と同じことを起こさないように記録しておきます。","Published":true},{"contentHtml":"<h2>ソート対象とする辞書の確認</h2>\n<p>まずは辞書を確認します。今回使用する辞書型は、ある文書に出現した単語と出現回数を示す<em>freq_words</em>という辞書としましょう。</p>\n<p>その中身は次になります。</p>\n<p>このデータを作成には、辞書の初期化を簡単に行ってくれる<em>collections.defaultdict</em>を使用しています。こちらの使い方と今回使用する辞書の生成は別記事で行っているので、そちらを別途参照されたい。<a href=\"https://yuta0306.github.io/blog/defaultdict-usage\">【defaultdict】で辞書型の初期化をサボる</a></p>\n<pre><code class=\"hljs language-python\">defaultdict(&#x3C;<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> '<span class=\"hljs-title\">int</span>'>, {'<span class=\"hljs-title\">Python</span>':</span> <span class=\"hljs-number\">23</span>, <span class=\"hljs-string\">'-'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Wikipedia'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'From'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Wikipedia,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'the'</span>: <span class=\"hljs-number\">15</span>, <span class=\"hljs-string\">'free'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'encyclopedia'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Jump'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'to'</span>: <span class=\"hljs-number\">9</span>, <span class=\"hljs-string\">'navigation'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'search'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'Look'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'up'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'or'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'python'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'in'</span>: <span class=\"hljs-number\">7</span>, <span class=\"hljs-string\">'Wiktionary,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'dictionary.'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'may'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'refer'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'to:'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Pythons'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Pythonidae,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'a'</span>: <span class=\"hljs-number\">19</span>, <span class=\"hljs-string\">'family'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'of'</span>: <span class=\"hljs-number\">12</span>, <span class=\"hljs-string\">'nonvenomous'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'snakes'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'found'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'Africa,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Asia,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'and'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'Australia'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'genus,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'genus'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Pythonidae'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Africa'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Asia'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Contents'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'1'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Computing'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'2'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'People'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'3'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'Roller'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'coasters'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'4'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Vehicles'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'5'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Weaponry'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'6'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Other'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'uses'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'7'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'See'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'also'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Computing[edit]'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'programming'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'language'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Python,'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'native'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'code'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'compiler'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'for'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'CMU'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Common'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Lisp'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'internal'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'project'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'name'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'PERQ'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'computer'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'workstation'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'People[edit]'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Aenus'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'4th-century'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'BCE,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'student'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Plato'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'painter,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'ca.'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'360-320'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'BCE'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'vase'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'painter'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Poseidonia'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Byzantium,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'orator,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'diplomat'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Philip'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'II'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Macedon'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Catana,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'poet'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'who'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'accompanied'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Alexander'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Great'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Anghelo'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'1954–2014'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Romanian'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'graphic'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'artist'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'coasters[edit]'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Efteling,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'roller'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'coaster'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'Netherlands'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Busch'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Gardens'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Tampa'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Bay,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'defunct'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Coney'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Island,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Cincinnati,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Ohio,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'steel'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Vehicles[edit]'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'automobile'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'maker,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'an'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'Australian'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'car'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'company'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'Ford'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'prototype,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Ford'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'prototype'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'sports'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Weaponry[edit]'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'missile,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'series'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Israeli'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'air-to-air'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'missiles'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'nuclear'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'primary,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'gas-boosted'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'fission'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'primary'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'used'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'thermonuclear'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'weapons'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Colt'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'revolver'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'uses[edit]'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'PYTHON,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'British'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'nuclear'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'war'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'contingency'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'plan'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'film,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'2000'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'horror'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'film'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'by'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'Richard'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Clabaugh'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'mythology,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'mythical'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'serpent'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Monty'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Pythons,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'comedy'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'group'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Monty'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Pictures,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'owned'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">\"troupe's\"</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'surviving'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'members'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'also[edit]'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Cython,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'programming'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'language'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'superset'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Pyton,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Norwegian'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'magazine'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Pithon'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Disambiguation'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'page'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'providing'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'links'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'topics'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'that'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'could'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'be'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'referred'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'same'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'termThis'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'disambiguation'</span>: <span class=\"hljs-number\">5</span>, <span class=\"hljs-string\">'lists'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'articles'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'associated'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'with'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'title'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Python.'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'If'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'link'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'led'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'you'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'here,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'wish'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'change'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'point'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'directly'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'intended'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'article.'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Retrieved'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'from'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'\"https://en.wikipedia.org/w/index.php?title=Python&#x26;oldid=983067155\"'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Categories:'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'pagesHuman'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'pagesDisambiguation'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'pages'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'given-name-holder'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'listsHidden'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'categories:'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'short'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'descriptionsShort'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'description'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'is'</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">'different'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'WikidataAll'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'article'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'pagesAll'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'pagesAnimal'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'common'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Navigation'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'menu'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Personal'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'tools'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Not'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'logged'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'inTalkContributionsCreate'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'accountLog'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Namespaces'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'ArticleTalk'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Variants'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Views'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'ReadEditView'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'history'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'More'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Search'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Main'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'pageContentsCurrent'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'eventsRandom'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'articleAbout'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'WikipediaContact'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'usDonate'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Contribute'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'HelpLearn'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'editCommunity'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'portalRecent'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'changesUpload'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'file'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Tools'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'What'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'hereRelated'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'fileSpecial'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'pagesPermanent'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'linkPage'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'informationCite'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'this'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'pageWikidata'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'item'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Print/export'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Download'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'as'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'PDFPrintable'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'version'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'In'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'other'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'projects'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Wikimedia'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'Commons'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'Languages'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'AfrikaansAlemannischالعربيةAzərbaycancaবাংলাБеларускаяБългарскиČeštinaDanskDeutschEsperantoEuskaraفارسیFrançais한국어HrvatskiIdoBahasa'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'IndonesiaInterlinguaÍslenskaItalianoעבריתქართულიKongoLatinaLëtzebuergeschMagyarमराठीNederlands日本語Norsk'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'bokmålPolskiPortuguêsРусскийSlovenčinaСрпски'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'/'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'srpskiSrpskohrvatski'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'српскохрватскиSuomiSvenskaไทยTürkçeУкраїнськаاردوTiếng'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Việt中文'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Edit'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'This'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'was'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'last'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'edited'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'on'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'12'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'October'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'2020,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'at'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'01:39'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'UTC.'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Text'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'available'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'under'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Creative'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Attribution-ShareAlike'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'License;'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'additional'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'terms'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'apply.'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'By'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'using'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'site,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'agree'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Terms'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Use'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Privacy'</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">'Policy.'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Wikipedia®'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'registered'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'trademark'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Foundation,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Inc.,'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'non-profit'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'organization.'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'policy'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'About'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Disclaimers'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Contact'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Mobile'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'view'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Developers'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Statistics'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'Cookie'</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">'statement'</span>: <span class=\"hljs-number\">1</span>})</code></pre>\n<p>長いですがこのデータを使用します。</p>\n<h2>keyでソートする</h2>\n<p>それではキーでソートしていきます。</p>\n<p>ソート方法自体は、*sorted(ソート対象, key=ソートの基準, reverse=降順か昇順か)*で定義されるので、<em>key</em>の部分に<strong>lambda</strong>を採用してソートしていきます。コード自体は至って単純です。</p>\n<pre><code class=\"hljs language-python\">sort = <span class=\"hljs-built_in\">sorted</span>(freq_word.items(), key=<span class=\"hljs-keyword\">lambda</span> x:x[<span class=\"hljs-number\">0</span>])</code></pre>\n<p>これだけで昇順で並べることができます。結果を確認すると、(<em>print(sort)</em>)</p>\n<p>多すぎるので上位20個だけ並べます。(<em>print(sort[:20])</em>)</p>\n<pre><code class=\"hljs language-bash\">[(<span class=\"hljs-string\">'\"https://en.wikipedia.org/w/index.php?title=Python&#x26;oldid=983067155\"'</span>, 1), (<span class=\"hljs-string\">'(1954–2014)'</span>, 1), (<span class=\"hljs-string\">'(4th-century'</span>, 1), (<span class=\"hljs-string\">'(Busch'</span>, 1), (<span class=\"hljs-string\">'(Coney'</span>, 1), (<span class=\"hljs-string\">'(Efteling),'</span>, 1), (<span class=\"hljs-string\">'(Ford'</span>, 1), (<span class=\"hljs-string\">'(Monty)'</span>, 1), (<span class=\"hljs-string\">'(UTC).'</span>, 1), (<span class=\"hljs-string\">'(automobile'</span>, 1), (<span class=\"hljs-string\">'(ca.'</span>, 1), (<span class=\"hljs-string\">'(film),'</span>, 1), (<span class=\"hljs-string\">'(genus),'</span>, 1), (<span class=\"hljs-string\">'(missile),'</span>, 1), (<span class=\"hljs-string\">'(mythology),'</span>, 1), (<span class=\"hljs-string\">'(nuclear'</span>, 1), (<span class=\"hljs-string\">'(painter),'</span>, 1), (<span class=\"hljs-string\">'(programming'</span>, 1), (<span class=\"hljs-string\">'-'</span>, 1), (<span class=\"hljs-string\">'/'</span>, 2)]</code></pre>\n<p>一応記号から始まっているものが先に来ています。記号をしっかり前処理で省いていれば良かったのでしょうが...</p>\n<p>それでもキーを元にソートすることができました!!</p>\n<p><strong>降順</strong>にする場合は、<em>reverse=True</em>を付け足すだけで昇順になります。</p>\n<pre><code class=\"hljs language-python\">sort = <span class=\"hljs-built_in\">sorted</span>(freq_word.items(), key=<span class=\"hljs-keyword\">lambda</span> x:x[<span class=\"hljs-number\">0</span>], reverse=<span class=\"hljs-literal\">True</span>)</code></pre>\n<pre><code class=\"hljs language-bash\">[(<span class=\"hljs-string\">'српскохрватскиSuomiSvenskaไทยTürkçeУкраїнськаاردوTiếng'</span>, 1), (<span class=\"hljs-string\">'you'</span>, 3), (<span class=\"hljs-string\">'workstation'</span>, 1), (<span class=\"hljs-string\">'with'</span>, 3), (<span class=\"hljs-string\">'wish'</span>, 1), (<span class=\"hljs-string\">'who'</span>, 1), (<span class=\"hljs-string\">'weapons'</span>, 1), (<span class=\"hljs-string\">'was'</span>, 1), (<span class=\"hljs-string\">'war'</span>, 1), (<span class=\"hljs-string\">'view'</span>, 1), (<span class=\"hljs-string\">'version'</span>, 1), (<span class=\"hljs-string\">'vase'</span>, 1), (<span class=\"hljs-string\">'using'</span>, 1), (<span class=\"hljs-string\">'uses[edit]'</span>, 1), (<span class=\"hljs-string\">'uses'</span>, 1), (<span class=\"hljs-string\">'used'</span>, 1), (<span class=\"hljs-string\">'usDonate'</span>, 1), (<span class=\"hljs-string\">'up'</span>, 1), (<span class=\"hljs-string\">'under'</span>, 1), (<span class=\"hljs-string\">\"troupe's\"</span>, 1)]</code></pre>\n<p>しっかりアルファベッドで降順になっていました。</p>\n<h2>valueでソートする</h2>\n<p>続いて<em>value</em>でソートしていきます。</p>\n<p>先ほどと同様に、ソート方法自体は、*sorted(ソート対象, key=ソートの基準, reverse=降順か昇順か)*で定義されるので、<em>key</em>の部分に<strong>lambda</strong>を採用してソートしていきます。コード自体は至って単純です。</p>\n<pre><code class=\"hljs language-python\">sort = <span class=\"hljs-built_in\">sorted</span>(freq_word.items(), key=<span class=\"hljs-keyword\">lambda</span> x:x[<span class=\"hljs-number\">1</span>])</code></pre>\n<p>これだけで昇順で並べることができます。結果を確認すると、(<em>print(sort)</em>)</p>\n<p>多すぎるので上位20個だけ並べます。(<em>print(sort[:20])</em>)</p>\n<pre><code class=\"hljs language-bash\">[(<span class=\"hljs-string\">'-'</span>, 1), (<span class=\"hljs-string\">'From'</span>, 1), (<span class=\"hljs-string\">'Wikipedia,'</span>, 1), (<span class=\"hljs-string\">'encyclopedia'</span>, 1), (<span class=\"hljs-string\">'navigation'</span>, 1), (<span class=\"hljs-string\">'Look'</span>, 1), (<span class=\"hljs-string\">'up'</span>, 1), (<span class=\"hljs-string\">'python'</span>, 1), (<span class=\"hljs-string\">'Wiktionary,'</span>, 1), (<span class=\"hljs-string\">'dictionary.'</span>, 1), (<span class=\"hljs-string\">'refer'</span>, 1), (<span class=\"hljs-string\">'to:'</span>, 1), (<span class=\"hljs-string\">'Pythons'</span>, 1), (<span class=\"hljs-string\">'Pythonidae,'</span>, 1), (<span class=\"hljs-string\">'family'</span>, 1), (<span class=\"hljs-string\">'snakes'</span>, 1), (<span class=\"hljs-string\">'Africa,'</span>, 1), (<span class=\"hljs-string\">'Asia,'</span>, 1), (<span class=\"hljs-string\">'Australia'</span>, 1), (<span class=\"hljs-string\">'(genus),'</span>, 1)]</code></pre>\n<p>今回はデータが小さく、ほとんどが1なので正しくソートされているかはこれではわかりにくいですが、全体を出力すると正しいことがわかると思います。</p>\n<p>こちらもやはり<strong>降順</strong>にする場合は、<em>reverse=True</em>を付け足すだけで昇順になります。</p>\n<pre><code class=\"hljs language-python\">sort = <span class=\"hljs-built_in\">sorted</span>(freq_word.items(), key=<span class=\"hljs-keyword\">lambda</span> x:x[<span class=\"hljs-number\">1</span>], reverse=<span class=\"hljs-literal\">True</span>)</code></pre>\n<pre><code class=\"hljs language-bash\">[(<span class=\"hljs-string\">'Python'</span>, 23), (<span class=\"hljs-string\">'a'</span>, 19), (<span class=\"hljs-string\">'the'</span>, 15), (<span class=\"hljs-string\">'of'</span>, 12), (<span class=\"hljs-string\">'to'</span>, 9), (<span class=\"hljs-string\">'in'</span>, 7), (<span class=\"hljs-string\">'disambiguation'</span>, 5), (<span class=\"hljs-string\">'Wikipedia'</span>, 3), (<span class=\"hljs-string\">'or'</span>, 3), (<span class=\"hljs-string\">'may'</span>, 3), (<span class=\"hljs-string\">'and'</span>, 3), (<span class=\"hljs-string\">'Python,'</span>, 3), (<span class=\"hljs-string\">'name'</span>, 3), (<span class=\"hljs-string\">'roller'</span>, 3), (<span class=\"hljs-string\">'coaster'</span>, 3), (<span class=\"hljs-string\">'by'</span>, 3), (<span class=\"hljs-string\">'Disambiguation'</span>, 3), (<span class=\"hljs-string\">'page'</span>, 3), (<span class=\"hljs-string\">'links'</span>, 3), (<span class=\"hljs-string\">'with'</span>, 3)]</code></pre>\n<p>回数が多い順（降順）になっていますね。</p>\n<p>辞書型はこのように、<em>sorted(dict.items(), key=lambda x:x[0 or 1], reverse=True or False</em>でソートすることができました。</p>\n<p>辞書型のソートは意外と悩むことが個人的には多いので、備忘録がてら公開しておきます。</p>\n","Title":"Pythonで【辞書型】をソートする","Date":"2020-10-15","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"py-sort-dict","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pyythonでソートをしたい時、初めの頃はあまり思いつかないことも多く、lambda式ってなんや...!?こんな状態でソートにはあまり手が出ず、コピペで戦っている方も多いのではないでしょうか。今回はその中でも「辞書型」のソートについてお話しします。","Published":true},{"contentHtml":"<p>ディープラーニングとか、とにかく複雑でメモリを使用するような計算処理が家庭用パソコンでもできる時代になりました。(そーゆー時代しか生きていないんですけど)とはいえ、メモリを意識せずともプログラムをかけているのは最適化されたライブラリを使っているからなわけで。。。そんなわけで自分でもメモリ管理を気をつけたいわけです。そこで、弱参照によって、うまいことPython処理系にメモリの破棄を促す方法をお話ししていきます。</p>\n<h2>Pyton処理系のお話</h2>\n<p>さて、これまでPythonを触ってきた僕ですが、メモリ管理を意識したことはほっとんどなく、大学の授業でC言語を学んだ際、低レイヤーの処理に少し不慣れで難しさを感じました。</p>\n<p>それくらいPython処理系はメモリ管理を強く意識させることはないということなのでしょう。</p>\n<p>それで、Python処理系は基本的には、<strong>オブジェクトが参照される回数をカウント</strong>して、参照するものがなくなった段階でメモリを破棄する。そんなイメージらしい。</p>\n<p>つまり、循環参照のような状態に陥ると、<strong>ユーザからは参照できないにもかかわらず、メモリに残ってしまう</strong>ということが発生するそうです。(他の手法でメモリが消されるのだろうが、こちらの消えて欲しいタイミングで消せることをメモリ管理と今回は考える)</p>\n<h2>メモリが即座に消されるパターン</h2>\n<p>以下が、参照カウント(あるオブジェクトを参照するものの数)によってきれいに即座にメモリが破棄されるパターンです。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">object</span>:</span>\n    <span class=\"hljs-keyword\">pass</span>\n    \n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">func</span>(<span class=\"hljs-params\">a</span>):</span>\n    <span class=\"hljs-built_in\">print</span>(a)\n    \na = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># a: 参照カウント 1</span>\nb = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># b: 参照カウント 1</span>\nc = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># c: 参照カウント 1</span>\n\na.b = b  <span class=\"hljs-comment\"># b: 参照カウント 2</span>\nb.c = c  <span class=\"hljs-comment\"># c: 参照カウント 2</span>\n\na = b = c = <span class=\"hljs-literal\">None</span>  <span class=\"hljs-comment\"># メモリ破棄(a, b, c: 参照カウント 0)&#x3C;/code></span></code></pre>\n<h2>循環参照により即座に破棄されないパターン</h2>\n<p>続いて、循環参照を起こしてみます。これによって、長い間メモリに<strong>ユーザが参照できないオブジェクトが残ってしまいます</strong>。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># ライブラリをインポート</span>\n<span class=\"hljs-keyword\">import</span> weakref\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">object</span>:</span>\n    <span class=\"hljs-keyword\">pass</span>\n    \n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">func</span>(<span class=\"hljs-params\">a</span>):</span>\n    <span class=\"hljs-built_in\">print</span>(a)\n    \na = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># a: 参照カウント 1</span>\nb = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># b: 参照カウント 1</span>\nc = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># c: 参照カウント 1</span>\n\n<span class=\"hljs-comment\"># 以下を弱参照で循環させる</span>\na.b = b  <span class=\"hljs-comment\"># b: 参照カウント 2</span>\nb.c = c  <span class=\"hljs-comment\"># c: 参照カウント 2</span>\nc.a = a  <span class=\"hljs-comment\"># a: 参照カウント 2</span>\n<span class=\"hljs-comment\"># 以下でメモリが破棄されているか参照する</span>\na_ref = weakref.ref(a)\nb_ref = weakref.ref(b)\nc_ref = weakref.ref(c)\n\na = b = c = <span class=\"hljs-literal\">None</span>  <span class=\"hljs-comment\"># メモリ破棄できない(a, b, c: 参照カウント 1)</span>\n\n<span class=\"hljs-built_in\">print</span>(a_ref, b_ref, c_ref)&#x3C;/code></code></pre>\n<p>出力はこんな感じです</p>\n<pre><code class=\"hljs language-bash\">&#x3C;weakref at 0x7fc5e3a49bf0; to <span class=\"hljs-string\">'object'</span> at 0x7fc5e3a40150> &#x3C;weakref at 0x7fc5e3a49c50; to <span class=\"hljs-string\">'object'</span> at 0x7fc5e3a40190> &#x3C;weakref at 0x7fc5e3a49cb0; to <span class=\"hljs-string\">'object'</span> at 0x7fc5e3a40250></code></pre>\n<p>破棄されていれば<em>dead</em>と書かれるはず...</p>\n<p>やはりダメですね。弱参照で破棄させましょう。</p>\n<h2>weakrefで改良</h2>\n<p>先ほどの問題を、<em>weakref.ref</em>を用いて、弱参照とすることで参照カウントを行わないように設定します。</p>\n<p>そうすることで参照カウントが最終的に0になり、メモリをPython処理系によって即座に破棄されることができます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># ライブラリをインポート</span>\n<span class=\"hljs-keyword\">import</span> weakref\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">object</span>:</span>\n    <span class=\"hljs-keyword\">pass</span>\n    \n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">func</span>(<span class=\"hljs-params\">a</span>):</span>\n    <span class=\"hljs-built_in\">print</span>(a)\n    \na = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># a: 参照カウント 1</span>\nb = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># b: 参照カウント 1</span>\nc = <span class=\"hljs-built_in\">object</span>()  <span class=\"hljs-comment\"># c: 参照カウント 1</span>\n\n<span class=\"hljs-comment\"># 以下を弱参照で循環させる</span>\na.b = weakref.ref(b)  <span class=\"hljs-comment\"># b: 参照カウント 0</span>\nb.c = weakref.ref(c)  <span class=\"hljs-comment\"># c: 参照カウント 0</span>\nc.a = weakref.ref(a)  <span class=\"hljs-comment\"># a: 参照カウント 0</span>\n<span class=\"hljs-comment\"># 以下でメモリが破棄されているか参照</span>\na_ref = weakref.ref(a)\nb_ref = weakref.ref(b)\nc_ref = weakref.ref(c)\n\na = b = c = <span class=\"hljs-literal\">None</span>  <span class=\"hljs-comment\"># メモリ破棄(a, b, c: 参照カウント 0)</span>\n\n<span class=\"hljs-built_in\">print</span>(a_ref, b_ref, c_ref)&#x3C;/code></code></pre>\n<p>出力がこんな感じ。</p>\n<pre><code class=\"hljs language-bash\">&#x3C;weakref at 0x7f868932dcb0; dead> &#x3C;weakref at 0x7f868932dbf0; dead> &#x3C;weakref at 0x7f868932dc50; dead></code></pre>\n<p>全て<em>dead</em>になっていますね。これで期待した通りのタイミングでメモリを破棄することができました!!!</p>\n<p>時には低いレイヤーまで考えてみるのも楽しいものですね。(時にはです。意識しなくていいことが幸せ)</p>\n","Title":"【weakref】弱い参照によってメモリ管理をする","Date":"2020-10-12","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"weakref","THUMBNAIL":"python.jpg","Description":"ディープラーニングとか、とにかく複雑でメモリを使用するような計算処理が家庭用パソコンでもできる時代になりました。(そーゆー時代しか生きていないんですけど)とはいえ、メモリを意識せずともプログラムをかけているのは最適化されたライブラリを使っているからなわけで。。。そんなわけで自分でもメモリ管理を気をつけたいわけです。そこで、弱参照によって、うまいことPython処理系にメモリの破棄を促す方法をお話ししていきます。","Published":true},{"contentHtml":"<p>線形代数ライブラリを作ろうと色々とプログラムを書いていたわけですが、なんとなくで転置行列をどう簡単に求めるかということを考え始めました。その時に思いついた転置行列の求め方を共有します。</p>\n<h2>一般解ぽいやつ(個人の見解)</h2>\n<p>まずは一般に使われそうな方法を考えてみました。</p>\n<p>入力行列は<em>3x2</em>の行列として、求める転置行列は<em>2x3</em>とします。対応するインデックスの関係がわかりやすいように数値を設定してみます。</p>\n<pre><code class=\"hljs language-python\">A = [\n    [<span class=\"hljs-number\">11</span>, <span class=\"hljs-number\">12</span>],\n    [<span class=\"hljs-number\">21</span>, <span class=\"hljs-number\">22</span>],\n    [<span class=\"hljs-number\">31</span>, <span class=\"hljs-number\">32</span>]\n]\n\nAt = []\nj = <span class=\"hljs-number\">0</span>\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(A[j])):\n    row = []\n    <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(A)):\n        row.append(A[j][i])\n    At.append(row)\n    \n<span class=\"hljs-built_in\">print</span>(At)</code></pre>\n<p>これで動くはず...オーソドックスか知らんけど、二重ループ回すのが一般的な思考だと思ったので、これを一般解として提示しました。</p>\n<p>ちなみに得られる出力はこちらです。</p>\n<pre><code class=\"hljs language-bash\">[[11, 21, 31], [12, 22, 32]]</code></pre>\n<p>多分大丈夫そう。</p>\n<h2>一般解ぽいやつを内包表記してみた</h2>\n<p>さきに示した一般解っぽいやつを内包表記を用いて書いてみます。</p>\n<pre><code class=\"hljs language-python\">A = [\n    [<span class=\"hljs-number\">11</span>, <span class=\"hljs-number\">12</span>],\n    [<span class=\"hljs-number\">21</span>, <span class=\"hljs-number\">22</span>],\n    [<span class=\"hljs-number\">31</span>, <span class=\"hljs-number\">32</span>]\n]\n\nj = <span class=\"hljs-number\">0</span>\nAt = [\n    [A[j][i] <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(A))]\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-built_in\">len</span>(A[j]))\n]\n<span class=\"hljs-built_in\">print</span>(At)</code></pre>\n<p>これも同様に同じ出力が得られます。</p>\n<pre><code class=\"hljs language-bash\">[[11, 21, 31], [12, 22, 32]]</code></pre>\n<h2>【本題】zipと展開の合わせ技</h2>\n<p>さて、本題です。僕が思いついた手法は以下になります。</p>\n<ol>\n<li>A(入力行列)を展開して、行列から列ごとに展開</li>\n<li>zip()を用いて統合</li>\n<li>内包表記にて転置行列を生成</li>\n</ol>\n<p>こんな流れになります。言葉で言っても難しいので、コードをみてみます。</p>\n<pre><code class=\"hljs language-python\">A = [\n    [<span class=\"hljs-number\">11</span>, <span class=\"hljs-number\">12</span>],\n    [<span class=\"hljs-number\">21</span>, <span class=\"hljs-number\">22</span>],\n    [<span class=\"hljs-number\">31</span>, <span class=\"hljs-number\">32</span>]\n]\n\nAt = [\n    <span class=\"hljs-built_in\">list</span>(row) <span class=\"hljs-keyword\">for</span> row <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">zip</span>(*A)\n]\n<span class=\"hljs-built_in\">print</span>(At)</code></pre>\n<p>これだけです。</p>\n<p>ただ、注意すべき点が一つだけあります。</p>\n<p>**list()**としているところです。それはなぜかというと、zipで統合された物は<em>tuple</em>で帰ってきます。</p>\n<p>内包表記において、listをとると次のような出力になります。</p>\n<pre><code class=\"hljs language-bash\">[(11, 21, 31), (12, 22, 32)]</code></pre>\n<p><em>tuple</em>で返ってきても良いスクリプトであればそのままでも良いと思いますが、<em>tuple</em>だとイミュータブルなデータになってしまうので、大抵の場合**list()**でlist型に直してあげた方が良いことが多い気がします。</p>\n<p>処理速度は測っていませんが、おそらく大きなサイズの行列の入力の時は高速に動くと思います(多分)</p>\n<p>興味ある人は処理速度を計測してみてください。それでは、簡単な転置行列を求める方法の提案でした。(Pythonに限る)</p>\n","Title":"簡単に転置行列求めてみた","Date":"2020-10-12","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"py-trans-matrix","Thumbnail":"/images/thumbnails/python.jpg","Description":"線形代数ライブラリを作ろうと色々とプログラムを書いていたわけですが、なんとなくで転置行列をどう簡単に求めるかということを考え始めました。その時に思いついた転置行列の求め方を共有します。","Published":true},{"contentHtml":"<p>Pythonでクラスのインスタンスを生成して格納した変数を出力すると、class名とメモリ番地みたいなやつが出力されてしまいます。Pythonユーザーで機械学習とかで遊んでいる方はわかると思いますが、<em>numpy</em>はnp.ndarrayというクラスを持ちながら出力では行列が出力されます。線形代数計算ライブラリを自作している際、そのような特殊な出力にしたいことがありました。実際に行った方法をお話しします。</p>\n<p>正直タイトルにあるように、出落ちなのですが......</p>\n<p>*__str__*というPython独自の特殊メソッドを用いて、やりたいことを実現していきたいと思います。</p>\n<h2>やりたいこと</h2>\n<p>まずは、実際にやりたいことを明確にしていきます。<em>numpy</em>のような物を参考にしますが、今回は簡単のため、<em>Scalar</em>クラスを作ります。</p>\n<p>このクラスは、数値(intもしくはfloat)を受け取って、それを<em>data</em>として格納させます。</p>\n<p>求める最終形はこちらです。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">>>> </span>scalar = Scalar(<span class=\"hljs-number\">5</span>)\n<span class=\"hljs-meta\">>>> </span><span class=\"hljs-built_in\">print</span>(scalar)\nScalar(<span class=\"hljs-number\">5</span>)</code></pre>\n<p>本来であれば、*&#x3C;__main__.Scalar object at 0x7f85f3a00150>*のように表されてしまいますが、*Scalar(5)*というような特殊文字列にします。</p>\n<h2>Scalarクラスを作る</h2>\n<p>さて、これから<em>Scalar</em>クラスを作ります。</p>\n<p>初めは、最低限クラスとして機能するようなコードを書いていきます。</p>\n<p>Scalarクラスの仕様は以下とします。</p>\n<ul>\n<li>インスタンス生成時に<em>int</em>又は<em>float</em>を受け取る</li>\n<li>上の条件以外ならば、TypeErrorを発出</li>\n</ul>\n<p>これらの条件を満たすようにクラスを書いたのが以下になります。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Scalar</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, data</span>):</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">int</span>) <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">float</span>):\n            self.data = data\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">raise</span> TypeError(<span class=\"hljs-string\">'expect int or float, but {}'</span>, <span class=\"hljs-built_in\">type</span>(data))</code></pre>\n<p>これでメインルーティンを書いていきます。</p>\n<p>以下を試してみます。</p>\n<ul>\n<li>intを入力</li>\n<li>floatを入力</li>\n<li>listを入力</li>\n</ul>\n<p>さて、書きたします。先ほどのクラスを書いたファイルを拡張していきます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Scalar</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, data</span>):</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">int</span>) <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">float</span>):\n            self.data = data\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">raise</span> TypeError(<span class=\"hljs-string\">'expect int or float, but {}'</span>, <span class=\"hljs-built_in\">type</span>(data))\n            \n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    scalar = Scalar(<span class=\"hljs-number\">3</span>)\n    <span class=\"hljs-built_in\">print</span>(scalar)\n    scalar = Scalar(<span class=\"hljs-number\">3.0</span>)\n    <span class=\"hljs-built_in\">print</span>(scalar)\n    scalar = Scalar([<span class=\"hljs-number\">3</span>])\n    <span class=\"hljs-built_in\">print</span>(scalar)</code></pre>\n<p>ターミナルで実行してみます。</p>\n<pre><code class=\"hljs language-bash\">$ python scalar.py\n&#x3C;__main__.Scalar object at 0x7fddd4300150>\n&#x3C;__main__.Scalar object at 0x7fddd4300190>\nTraceback (most recent call last):\n  File <span class=\"hljs-string\">\"scalar.py\"</span>, line 13, <span class=\"hljs-keyword\">in</span> &#x3C;module>\n    scalar = Scalar([3])\n  File <span class=\"hljs-string\">\"scalar.py\"</span>, line 6, <span class=\"hljs-keyword\">in</span> __init__\n    raise TypeError(<span class=\"hljs-string\">'expect int or float, but {}'</span>, <span class=\"hljs-built_in\">type</span>(data))\nTypeError: (<span class=\"hljs-string\">'expect int or float, but {}'</span>, class <span class=\"hljs-string\">'list'</span>)</code></pre>\n<p>3と3.0の入力は受け取れましたが、どうやら[3]の入力は期待した通りエラーを出してくれています。</p>\n<p>しかし、やはりこのままではクラスをそのまま出力してしまっています。</p>\n<h2>【<strong>str</strong>】の出番</h2>\n<p>それでは、__str__という特殊メソッドを用いて、出力結果を変更していきます。</p>\n<p>先までのクラスを以下のように変えていきます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Scalar</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, data</span>):</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">int</span>) <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">float</span>):\n            self.data = data\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">raise</span> TypeError(<span class=\"hljs-string\">'expect int or float, but {}'</span>, <span class=\"hljs-built_in\">type</span>(data))\n            \n    &#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">comment</span>\"># 以下を追加\n    <span class=\"hljs-title\">def</span> <span class=\"hljs-title\">__str__</span>(<span class=\"hljs-params\">self</span>):</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'Scalar({})'</span>.<span class=\"hljs-built_in\">format</span>(self.data)</code></pre>\n<p>最後の2行を追加する感じです。</p>\n<p>それでは、<em>int</em>と<em>float</em>以外はエラーを出すことを確認しているのでメインルーティンも同時に変えて以下のファイルとして完成させましょう。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Scalar</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, data</span>):</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">int</span>) <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">float</span>):\n            self.data = data\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">raise</span> TypeError(<span class=\"hljs-string\">'expect int or float, but {}'</span>, <span class=\"hljs-built_in\">type</span>(data))\n            \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__str__</span>(<span class=\"hljs-params\">self</span>):</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'Scalar({})'</span>.<span class=\"hljs-built_in\">format</span>(self.data)\n        \n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    scalar = Scalar(<span class=\"hljs-number\">3</span>)\n    <span class=\"hljs-built_in\">print</span>(scalar)\n    scalar = Scalar(<span class=\"hljs-number\">3.0</span>)\n    <span class=\"hljs-built_in\">print</span>(scalar)</code></pre>\n<p>この出力結果はどうなるでしょうか......(ドキドキ??)</p>\n<pre><code class=\"hljs language-bash\">$ python scalar.py\nScalar(3)\nScalar(3.0)</code></pre>\n<p>期待した通りの結果ですね!!</p>\n<p>このように、クラスのインスタンスの出力を制御するには**<strong>str</strong>**という特殊メソッドを使うと良いみたいです。</p>\n<p>ただし、<strong>__repr</strong>というものもあります。今回のソースに関しては正直いうと、この**<strong>repr</strong>**の方が適している気がします。(evalを使えば可逆的に戻すことができるため)</p>\n<p>詳しくはこちらを参照されたい(<a href=\"https://docs.python.org/ja/3/reference/datamodel.html\">https://docs.python.org/ja/3/reference/datamodel.html</a>)</p>\n<h2>今回のソースの推奨</h2>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Scalar</span>:</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, data</span>):</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">int</span>) <span class=\"hljs-keyword\">or</span> <span class=\"hljs-built_in\">isinstance</span>(data, <span class=\"hljs-built_in\">float</span>):\n            self.data = data\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">raise</span> TypeError(<span class=\"hljs-string\">'expect int or float, but {}'</span>, <span class=\"hljs-built_in\">type</span>(data))\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__repr__</span>(<span class=\"hljs-params\">self</span>):</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'Scalar({})'</span>.<span class=\"hljs-built_in\">format</span>(self.data)\n        \n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    scalar = Scalar(<span class=\"hljs-number\">3</span>)\n    <span class=\"hljs-built_in\">print</span>(scalar)\n    scalar = Scalar(<span class=\"hljs-number\">3.0</span>)\n    <span class=\"hljs-built_in\">print</span>(scalar)</code></pre>\n","Title":"classの標準出力を特殊な文字列にしたい【__str__|__repr__】","Date":"2020-10-12","Category":"Python","Tags":["Python","特殊メソッド","オブジェクト指向"],"Authors":"ゆうぼう","Slug":"py-class-repr","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonでクラスのインスタンスを生成して格納した変数を出力すると、class名とメモリ番地みたいなやつが出力されてしまいます。Pythonユーザーで機械学習とかで遊んでいる方はわかると思いますが、*numpy*はnp.ndarrayというクラスを持ちながら出力では行列が出力されます。線形代数計算ライブラリを自作している際、そのような特殊な出力にしたいことがありました。実際に行った方法をお話しします。","Published":true},{"contentHtml":"<p>Pythonからtkinterを使ってGUIを実装していました。Entryを使ってユーザの入力値を受け取ることができますが、デフォルト値の設定の仕方に困ったので、デフォルト値を設定した方法を共有します。</p>\n<h2>まずはEntryを生成</h2>\n<p>とりあえずコピペしたら動くようにします。</p>\n<p>ちなみに今回の僕の環境は以下になります。同じ環境で動かしたい場合は、以下のライブラリを<em>requirements.txt</em>にコピペでもして、インストールしてください。</p>\n<pre><code class=\"hljs language-bash\">altgraph==0.17\ncertifi==2020.6.20\nmacholib==1.14\nmysql-connector-python==8.0.21\nprotobuf==3.13.0\npyinstaller==4.0\npyinstaller-hooks-contrib==2020.9\nsix==1.15.0</code></pre>\n<pre><code class=\"hljs language-bash\">pip install -r  requirements.txt</code></pre>\n<p>上のやつをターミナルで回せばインストールできると思います。</p>\n<p>さて、本題。。。</p>\n<p>まずは、Entryを生成します。今回は、<em>entry.py</em>に書いていきます。</p>\n<p>一番大きなくくりのクラスを<em>App</em>として、このインスタンスをメインルーティンで立てていきます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> tkinter <span class=\"hljs-keyword\">as</span> tk\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">App</span>(<span class=\"hljs-params\">tk.Tk</span>):</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, *args, **kwargs</span>):</span>\n        <span class=\"hljs-comment\"># 魔法</span>\n        tk.Tk.__init__(self, *args, **kwargs)\n\n        <span class=\"hljs-comment\"># 以下でタイトルとウィンドウサイズを設定</span>\n        self.title(<span class=\"hljs-string\">u\"tkinterでEntryにデフォルト値を入れたい\"</span>)\n        self.geometry(<span class=\"hljs-string\">\"500x300\"</span>)\n\n        <span class=\"hljs-comment\"># Frameを生成</span>\n        self.frame = tk.Frame()\n        self.frame.pack()\n        <span class=\"hljs-comment\"># Labelを生成</span>\n        label = tk.Label(self.frame, text=<span class=\"hljs-string\">'Your name'</span>)\n        label.pack()\n        <span class=\"hljs-comment\"># Entryを生成</span>\n        name = tk.Entry(self.frame)\n        name.pack()\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    app = App()\n    app.mainloop()</code></pre>\n<p>これでとりあえずエントリー(入力受付)が可能になります。ここでUIは一切凝っていないので、下のような状態になると思います。</p>\n<p><img src=\"/images/article/tk-entry-default_1.png\" alt=\"完成画面\"></p>\n<p>この入力受付に対して、「山田太郎」をデフォルト値として設定していきたいと思います。</p>\n<h2>デフォルト値の設定</h2>\n<p>続いて、「山田太郎」をデフォルト値として設定していきます。基盤は先ほどのコードになります。</p>\n<p>先に言うと、*tk.Entry().insert()*メソッドを用いて、エントリーに対して文字列を挿入します。</p>\n<p>それではコードを追加しましょう。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> tkinter <span class=\"hljs-keyword\">as</span> tk\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">App</span>(<span class=\"hljs-params\">tk.Tk</span>):</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, *args, **kwargs</span>):</span>\n        <span class=\"hljs-comment\"># 魔法</span>\n        tk.Tk.__init__(self, *args, **kwargs)\n\n        <span class=\"hljs-comment\"># 以下でタイトルとウィンドウサイズを設定</span>\n        self.title(<span class=\"hljs-string\">u\"tkinterでEntryにデフォルト値を入れたい\"</span>)\n        self.geometry(<span class=\"hljs-string\">\"500x300\"</span>)\n\n        <span class=\"hljs-comment\"># Frameを生成</span>\n        self.frame = tk.Frame()\n        self.frame.pack()\n        <span class=\"hljs-comment\"># Labelを生成</span>\n        label = tk.Label(self.frame, text=<span class=\"hljs-string\">'Your name'</span>)\n        label.pack()\n        <span class=\"hljs-comment\"># Entryを生成</span>\n        name = tk.Entry(self.frame)\n\n        <span class=\"hljs-string\">\"\"\"ここにコードを1行追加\"\"\"</span>\n        name.insert(<span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">\"山田太郎\"</span>)\n        <span class=\"hljs-string\">\"\"\"ここにコードを1行追加\"\"\"</span>\n\n        name.pack()\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    app = App()\n    app.mainloop()</code></pre>\n<p>概要は上記のようになります。</p>\n<p>後半部分に1行足しただけです。足したのはこれ。</p>\n<p><strong>name.insert(0, \"山田太郎\")</strong></p>\n<p>第一引数はインデックスを指していて、今回はエントリーの一番初めに挿入したいので、<em>0</em>を入れました。</p>\n<p>第二引数は実際に挿入したい値です。よって、今回は「<em>山田太郎</em>」を書きました。</p>\n<p>こうすることで結果は以下が得られると思います。</p>\n<p><img src=\"/images/article/tk-entry-default_2.png\" alt=\"挿入後完成画面\"></p>\n<p>これでデフォルト値の設定ができました。</p>\n<p>正攻法なのかは定かではないですが......www</p>\n<p>これでデフォルト値の設定ができました。必要な時は是非ご活用を。</p>\n","Title":"【Python】tkinterでEntryにデフォルト値を入れたい","Date":"2020-10-07","Category":"Python","Tags":["Python","Tkinter"],"Authors":"ゆうぼう","Slug":"tk-entry-default","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonからtkinterを使ってGUIを実装していました。Entryを使ってユーザの入力値を受け取ることができますが、デフォルト値の設定の仕方に困ったので、デフォルト値を設定した方法を共有します。","Published":true},{"contentHtml":"<p>時々、Seleniumで要素を取得してクリックした際、うまくいかないことがあります。その時いくつかの解決策があるのですが、今回はJavaScriptを発火させて解決する方法を解説していきます。。</p>\n<p>それでは早速やってみます。</p>\n<p>前提条件は以下になります。</p>\n<ul>\n<li>Python環境が整っている</li>\n<li>Seleniumをインストール済み</li>\n<li>chromedriverをインストール済み</li>\n</ul>\n<h2>SeleniumからJavascriptを発火する</h2>\n<p>JavaScriptを発火させることはとても簡単です。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> selenium <span class=\"hljs-keyword\">import</span> webdriver\n<span class=\"hljs-keyword\">import</span> chromedriver_binary\n\ndriver = webdriver.Chrome()\ndriver.get(<span class=\"hljs-string\">'https://www.example.com/'</span>)\ndriver.execute_script(<span class=\"hljs-string\">'Your Procedure'</span>)</code></pre>\n<p>まずは、Webdriverを開き、その後<em>execute_script</em>メソッドを用いて、引数にJSのスクリプトを書き込むのみです。</p>\n<h2>実際にボタンをクリックしてみる!</h2>\n<p>実際にJSのスクリプトと合わせて、<em>#button</em>を持つ要素をクリックしてみましょう。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> selenium <span class=\"hljs-keyword\">import</span> webdriver\n<span class=\"hljs-keyword\">import</span> chromedriver_binary\n\ndriver = webdriver.Chrome()\ndriver.get(<span class=\"hljs-string\">'https://www.example.com/'</span>)\ndriver.execute_script(<span class=\"hljs-string\">'document.getElementById(\"button\").click();'</span>)</code></pre>\n<p>スクリプト全体の流れは以下になります。</p>\n<ol>\n<li>必要なモジュールをインポート</li>\n<li>webdriver立ち上げる</li>\n<li>対象のサイトを開く</li>\n<li><em>execute_script</em>でJSを発火</li>\n</ol>\n<p>上記のスクリプトはこの流れになります。</p>\n<p>時々、ポップアップとかトレース型広告とかでクリックできない場面があります。\nその際はJSから直押ししてあげるとうまく行くことがあります。</p>\n<p>この方法で解決できない場面も多いですが、比較的容易な手法なので頭の中に一つの解決策として留めておくのもありだと思います。</p>\n","Title":"Seleniumからクリックができない...そうだ、JSからクリックしよう","Date":"2020-09-26","Category":"Python","Tags":["Python","Selenium"],"Authors":"ゆうぼう","Slug":"selenium-click-by-js","Thumbnail":"/images/thumbnails/python.jpg","Description":"時々、Seleniumで要素を取得してクリックした際、うまくいかないことがあります。その時いくつかの解決策があるのですが、今回はJavaScriptを発火させて解決する方法を解説していきます。","Published":true},{"contentHtml":"<p>データ収集中にint型に文字列をパースすることがあったのですが、みるからに数値なのにエラーが返ってきました。これは何気にドツボでした。</p>\n<h2>ValueErrorの発生</h2>\n<p>エラーを招いたコードの例がこちら</p>\n<pre><code class=\"hljs language-python\">a = np.array([<span class=\"hljs-string\">'1.0'</span>, <span class=\"hljs-string\">'2.0'</span>]).astype(<span class=\"hljs-string\">'int16'</span>)</code></pre>\n<p>実際に出たエラーがこちらです。</p>\n<pre><code class=\"hljs language-bash\">ValueError: invalid literal <span class=\"hljs-keyword\">for</span> int() with base 10:</code></pre>\n<p>エラー読んでもいまいち理解できませんでした。</p>\n<p>正しくないリテラル...どういうこっちゃ!?</p>\n<h2>【原因】文字列が小数だった</h2>\n<p>原因は意外にもシンプルで、文字列の形が<strong>小数</strong>だったからみたいです...</p>\n<p>他のコードで確認してみると</p>\n<pre><code class=\"hljs language-python\">a = np.array([<span class=\"hljs-string\">'1'</span>, <span class=\"hljs-string\">'2'</span>]).astype(<span class=\"hljs-string\">'int16'</span>)\n\n<span class=\"hljs-comment\"># >> array([1, 2], dtype=int16</span></code></pre>\n<pre><code class=\"hljs language-python\">a = np.array([<span class=\"hljs-string\">'1.0'</span>, <span class=\"hljs-string\">'2.0'</span>]).astype(<span class=\"hljs-string\">'float32'</span>)\n\n<span class=\"hljs-comment\"># >> array([1, 2], dtype=float32)</span></code></pre>\n<p>小数であった時、floatへの変換はうまくいっているようです。</p>\n<h2>改善策</h2>\n<p>いったんfloatに変換してから、intに変換するとできます。遠回りですが。</p>\n<pre><code class=\"hljs language-python\">a = np.array([<span class=\"hljs-string\">'1.0'</span>, <span class=\"hljs-string\">'2.0'</span>]).astype(<span class=\"hljs-string\">'float32'</span>).astype(<span class=\"hljs-string\">'int16'</span>)\n\n<span class=\"hljs-comment\"># >> array([1, 2], dtype=int16)</span></code></pre>\n<p>このようなエラーに直面したら、<strong>配列の中身の文字列が少数になっていないか</strong>確認してみましょう!!</p>\n","Title":"invalid literal for int() with base 10: でint型のパースでエラーが！ ","Date":"2020-09-11","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"parse-int-base10","Thumbnail":"/images/thumbnails/python.jpg","Description":"データ収集中にint型に文字列をパースすることがあったのですが、みるからに数値なのにエラーが返ってきました。これは何気にドツボでした。","Published":true},{"contentHtml":"<p>Macは普段使いなので、あまり情報収集に使いたくなかったために、常時Windowsのノートパソコンを情報収集ボットとしようとしました。</p>\n<p>その時コードの共有をDropboxを用いたのですが、なぜかいくらpandasを入れても<br>\n<em>\"No module named 'pandas.core.internals.managers'; 'pandas.core.internals' is not a package\"</em><br>\nというエラーが...</p>\n<p>その原因がわかったのでそのお話をします。</p>\n<h2>\"No module\"エラーの発生!?</h2>\n<p>前述したとおり、環境の違う状態でコードを共有したわけです。</p>\n<p>確認してみると、やはりpandasのバージョンが違っていました。他の記事でも採算を話をしていますが、機械学習によく使われるライブラリたちは特段アップデートが早く、さらに大幅な変更も多い印象です。</p>\n<p>実際に起こった原因は、<strong>pickleに入れたpandasとロード先のpandasのバージョンの違い</strong>でした。</p>\n<p>実際の僕のバージョンは以下でした。</p>\n<table>\n<thead>\n<tr>\n<th>対象</th>\n<th>pandasのバージョン</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>以前のpandas</td>\n<td>0.24.2</td>\n</tr>\n<tr>\n<td>移植先のpandas</td>\n<td>0.23.1</td>\n</tr>\n</tbody>\n</table>\n<p>そのバージョンが違うと次のようなエラーが出ることがあります。</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-string\">\"No module named 'pandas.core.internals.managers'; 'pandas.core.internals' is not a package\"</span></code></pre>\n<p>上のようなモジュールがないよ！！</p>\n<p>と怒られるわけです。</p>\n<p>なので、次の解決策を示します</p>\n<ul>\n<li>再度データを作り直す</li>\n<li>前の環境を調べてinstallし直す</li>\n<li>前の環境にrequirements.txtを作成しておいて同じ環境を立てる</li>\n</ul>\n<p>次のセクションでお話をします。</p>\n<h2>再度データを作り直す</h2>\n<p>このやり方はいうまでもないですが、もう一度作り直す方法です。</p>\n<p>前の環境がわからないなど、どうしようもない時はこの方法で太刀打ちすれば良いかと思います</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> pandas <span class=\"hljs-keyword\">as</span> pd\n<span class=\"hljs-keyword\">import</span> pickle\n\ndf = pd.DataFrame()\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">'sample.pickle'</span>, <span class=\"hljs-string\">'wb'</span>) <span class=\"hljs-keyword\">as</span> f:\n    pickle.load(df, f)</code></pre>\n<p>といったように、現状の環境で作り直す方法です。</p>\n<h2>前の環境を調べてinstallし直す</h2>\n<p>前の環境でのバージョンが分かっていれば入れ直せば良いでしょう。</p>\n<pre><code class=\"hljs language-bash\">$ pip install pandas==<span class=\"hljs-string\">'your pandas version'</span></code></pre>\n<p>これで特定のバージョンのpandasを入手できるはずです。</p>\n<h2>前の環境にrequirements.txtを作成しておいて同じ環境を立てる</h2>\n<p>前の環境が目の前にあるならば、以下のようにして<em>requirements.txt</em>を作成してしまえば早いでしょう。</p>\n<pre><code class=\"hljs language-bash\">$ pip freeze > requirements.txt</code></pre>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-comment\"># 新しい環境にて</span>\n$ pip install -r requirements.txt</code></pre>\n<p>これで以前と同じ環境が整うので、心配なく動くと思います。</p>\n","Title":"pickleでロードした時pandasがあるのに\"No module ~~\"で悩んだ件について","Date":"2020-09-10","Category":"Python","Tags":["Python","Pandas"],"Authors":"ゆうぼう","Slug":"pandas-nomodule","Thumbnail":"/images/thumbnails/python.jpg","Description":"Macは普段使いなので、あまり情報収集に使いたくなかったために、常時Windowsのノートパソコンを情報収集ボットとしようとしました。その時コードの共有をDropboxを用いたのですが、なぜかいくらpandasを入れても\"No module named 'pandas.core.internals.managers'; 'pandas.core.internals' is not a package\"というエラーが。。。その原因がわかったのでそのお話をします。","Published":true},{"contentHtml":"<p>他のディレクトリで作ったモジュールの<em>import</em>をさせたかったのですが、その方法がイマイチわからなくて詰まりました。</p>\n<p>下の階層にあるなら\"<em>.</em>\"でつなげばいいのですが、階層を遡る必要があると困ったので解決策を提示します。</p>\n<p>今回は下層にあるとして進めます。階層が深くなると.(ドット)による記述が無駄に長くなるので、ある程度この記述で冗長な記述も避けられるかな？？と思ったからです。</p>\n<h2>やりたかったこと</h2>\n<p>他のディレクトリ内のモジュールを引っ張ってくる。</p>\n<p>階層構造は以下のようにしてみる</p>\n<pre><code class=\"hljs language-bash\">--- target\n    |      |\n    |      |--- sample.py\n    |\n    |--- main.py  &#x3C;-- 今ここ</code></pre>\n<p>で、直感的にやりたかったのがこれ</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">@ main.py</span>\n<span class=\"hljs-keyword\">from</span> target.sample <span class=\"hljs-keyword\">import</span> Sample</code></pre>\n<p>これはできるんだけど、もし<br>\n<em>from target.target1.target2.sample import Sample</em><br>\nとかだったらすごく萎えるよね...</p>\n<h2>【 解決策 】Pathにセットしてあげる</h2>\n<p><strong>sysとosを使って解決します!!</strong></p>\n<p>先ほどの階層構造に則ると、参照して欲しいディレクトリはtargetですね。</p>\n<p>先に手順を話すと以下になります。</p>\n<ol>\n<li>sysとosのimport</li>\n<li>os.getcwd()でカレントディレクトリを取得(今回は同じ階層のディレクトリにつながっているため)</li>\n<li>sys.path.append()でPathを追加</li>\n</ol>\n<p>この手順にのっとって書いてみます</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-comment\"># 手順1</span>\n<span class=\"hljs-keyword\">import</span> sys\n<span class=\"hljs-keyword\">import</span> os\n\n<span class=\"hljs-comment\"># 手順2 &#x26; 3</span>\nsys.path.append(os.getcwd() + <span class=\"hljs-string\">'target'</span>)\n<span class=\"hljs-keyword\">from</span> sample <span class=\"hljs-keyword\">import</span> Sample</code></pre>\n<p>一応これで対応できました。</p>\n<p>もし仮に4層、5層...と続いてもpathをセットしておけば、探してくれるので大丈夫です。</p>\n<p>階層を遡るときは、その都度pathにいれるパスを変えてみてください!!</p>\n","Title":"自作のモジュールを他のディレクトリから持ってきたい!!","Date":"2020-09-03","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"python-add-path","Thumbnail":"/images/thumbnails/python.jpg","Description":"機械学習の学習中に、他のディレクトリで作った自作関数が使いたかったのだけど、うまくimportする方法に悩みました。pythonがモジュールを探すpathをセットしてあげるだけで済んだので、その方法を解説します。","Published":true},{"contentHtml":"<p>Pythonで始める機械学習でお勉強中にFutureWarningに遭遇しました。GroupKFoldで起こったのですが、とりあえず今は使えるもののこの先使えなくなることが示されているので修正します。</p>\n<h2>FutureWarningを発生させてみる</h2>\n<p>少し前の書籍の型に合わせてコードを書いてみます。<del>FutureWarning</del>が発生するはずです。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">@python</span>\n\n<span class=\"hljs-keyword\">from</span> sklearn.model_selection <span class=\"hljs-keyword\">import</span> GroupKFold  <span class=\"hljs-comment\"># グループ交差検証</span>\n<span class=\"hljs-keyword\">from</span> sklearn.datasets <span class=\"hljs-keyword\">import</span> make_blobs  <span class=\"hljs-comment\"># 合成データ生成</span>\n\n<span class=\"hljs-comment\"># 合成データセットを生成</span>\nX, y = make_blobs(n_samples=<span class=\"hljs-number\">10</span>, random_state=<span class=\"hljs-number\">0</span>)\n<span class=\"hljs-comment\"># 最初の2サンプルが同じグループに、次の4つが同じグループに</span>\ngroups = [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">4</span>]\nscores = cross_val_score(logreg, X, y, groups, cv=GroupKFold(n_splits=<span class=\"hljs-number\">3</span>))\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Cross-validation scores:\\n{}\"</span>.<span class=\"hljs-built_in\">format</span>(scores))</code></pre>\n<p>おそらくこの型が少し前の技術書の仕様だと思います。<em>Pythonで始める機械学習</em>もこの型でした。</p>\n<p>結果をみてみます。</p>\n<pre><code class=\"hljs language-bash\">Cross-validation scores:\n[0.5 1.  1. ]\n/Users/user/opt/anaconda3/envs/ML/lib/python3.6/site-packages/sklearn/utils/validation.py:71: \nFutureWarning: Pass groups=[0, 0, 1, 1, 1, 1, 3, 3, 4, 4] as keyword args. \nFrom version 0.25 passing these as positional arguments will result <span class=\"hljs-keyword\">in</span> an error\nFutureWarning)</code></pre>\n<p>こんな感じのWarningが発生します。</p>\n<p>最後の方を読んでみると、<strong>バージョン0.25からはgroups配列は位置引数としてだとエラーになるよ</strong>みたいな感じのことを言っています。改善方法は至ってシンプルです。<br>\n次に示します。</p>\n<h2>改善策</h2>\n<p>改善策は至ってシンプルです。</p>\n<p>**groups=(グループ配列)**にすればいいのです。直したコードを示します。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-meta\">@python</span>\n\n<span class=\"hljs-keyword\">from</span> sklearn.model_selection <span class=\"hljs-keyword\">import</span> GroupKFold  <span class=\"hljs-comment\"># グループ交差検証</span>\n<span class=\"hljs-keyword\">from</span> sklearn.datasets <span class=\"hljs-keyword\">import</span> make_blobs  <span class=\"hljs-comment\"># 合成データ生成</span>\n\n<span class=\"hljs-comment\"># 合成データセットを生成</span>\nX, y = make_blobs(n_samples=<span class=\"hljs-number\">10</span>, random_state=<span class=\"hljs-number\">0</span>)\n<span class=\"hljs-comment\"># 最初の2サンプルが同じグループに、次の4つが同じグループに</span>\ngroups = [<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">4</span>]\nscores = cross_val_score(logreg, X, y, groups=groups, cv=GroupKFold(n_splits=<span class=\"hljs-number\">3</span>))\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"Cross-validation scores:\\n{}\"</span>.<span class=\"hljs-built_in\">format</span>(scores))</code></pre>\n<p>直したのはこの部分</p>\n<pre><code class=\"hljs language-python\">scores = cross_val_score(logreg, X, y, groups=groups, cv=GroupKFold(n_splits=<span class=\"hljs-number\">3</span>))</code></pre>\n<p>単に<em>groups=groups</em>にするだけです。これだけで直ります。</p>\n<p>やはりFutureWarningが多いですね〜この周りは。</p>\n","Title":"Scikit-learnのGroupKFoldでgroups配列でWarning発生!!","Date":"2020-08-18","Category":"Python","Tags":["Scikit-learn","Python"],"Authors":"ゆうぼう","Slug":"groupfold-groups","Thumbnail":"/images/thumbnails/network.jpg","Description":"Pythonで始める機械学習でお勉強中にFutureWarningに遭遇しました。GroupKFoldで起こったのですが、とりあえず今は使えるもののこの先使えなくなることが示されているので修正します。","Published":true},{"contentHtml":"<p>MeCabを利用したWebアプリケーションをHerokuにデプロイしようとして、環境をrequirements.txtにまとめていたのですが、、、どうしてもエラーが出てインストールが止まってしまうことがありました。原因は、Mecabだったようなので、エラー回避方法を共有します。</p>\n<p>前提条件として、</p>\n<ul>\n<li>mecabを<em>pip mecab</em>でインストール済み</li>\n<li>HerokuをCLIでいじる準備ができている</li>\n</ul>\n<h2>とりあえずrequirements.txtを作成</h2>\n<p>まあ、pip listしてまず現環境におけるライブラリをみていきましょう。</p>\n<p>例えばこんな構成だとします。</p>\n<pre><code class=\"hljs language-bash\">(myvenv)$ ~ pip list\nPackage                Version\n---------------------- -------------------\ncertifi                2020.6.20\nchardet                3.0.4\nclick                  7.1.2\nFlask                  1.1.2\ngunicorn               20.0.4\nidna                   2.10\nitsdangerous           1.1.0\nJinja2                 2.11.2\nMarkupSafe             1.1.1\nmecab                  0.996.2\nmysql-connector-python 8.0.21\noauthlib               3.1.0\npip                    20.1.1\nprotobuf               3.12.4\nrequests               2.24.0\nrequests-oauthlib      1.3.0\nsetuptools             49.2.0.post20200714\nsix                    1.15.0\nurllib3                1.25.10\nWerkzeug               1.0.1\nwheel                  0.34.2</code></pre>\n<p>中段くらいにmecabのバージョン0.996.2がありますね。それではこれをもとに、requirements.txtを作成していきます。</p>\n<pre><code class=\"hljs language-bash\">(myvenv)$ ~ pip freeze > requirements.txt</code></pre>\n<p>これで下準備OKです</p>\n<h2>Herokuへログインしてデプロイ</h2>\n<p>それではコマンドラインを開きまして、デプロイしていきましょう。</p>\n<pre><code class=\"hljs language-bash\">$ ~ heroku % login</code></pre>\n<p>これを打つと、認証画面的にブラウザが勝手に開きます。それでログインできていれば、この画面を消してターミナルに戻る旨の内容が書かれています。</p>\n<p>それで、成功したとして、次は</p>\n<pre><code class=\"hljs language-bash\">$ ~ % heroku git:<span class=\"hljs-built_in\">clone</span> -a your-app-name\n$ ~ % <span class=\"hljs-built_in\">cd</span> your-app-directory\n\n$ your-app-directory % git add .\n$ your-app-directorygit % commit -am <span class=\"hljs-string\">\"deploy!!\"</span>\n$ your-app-directorygit % push heroku master</code></pre>\n<p>こうするとPythonの場合、<strong>runtime.txt</strong>からPythonのバージョンを、<strong>requirements.txt</strong>から依存ライブラリのパッケージを確認して、インストールしていくと次のような問題が発生します。</p>\n<pre><code class=\"hljs language-bash\">-----> Python app detected\n-----> Installing python-3.8.5\n-----> Installing pip 20.0.2, setuptools 39.0.1 and wheel 0.34.2\n-----> Installing SQLite3\n-----> Installing requirements with pip\n    Collecting certifi==2020.6.20\n        Downloading certifi-2020.6.20-py2.py3-none-any.whl (156 kB)\n    Collecting chardet==3.0.4\n            ( 中略 )\n    Collecting mecab==0.996.2\n        Downloading mecab-0.996.2.tar.gz (62 kB)\n        ERROR: Command errored out with <span class=\"hljs-built_in\">exit</span> status 1:\n            <span class=\"hljs-built_in\">command</span>: /app/.heroku/python/bin/python -c <span class=\"hljs-string\">'import sys, setuptools, tokenize; sys.argv[0] = '</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">'/tmp/pip-install-kr1kq54r/\n            mecab/setup.py'</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">'; __file__='</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">'/tmp/pip-install-kr1kq54r/mecab/setup.py'</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">';f=getattr(tokenize, '</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">'open'</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">', open)\n            (__file__);code=f.read().replace('</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">'\\r\\n'</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">', '</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">'\\n'</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">');f.close();exec(compile(code, __file__, '</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">'exec'</span><span class=\"hljs-string\">\"'\"</span><span class=\"hljs-string\">'))'</span> \n            egg_info --egg-base /tmp/pip-install-kr1kq54r/mecab/pip-egg-info\n                cwd: /tmp/pip-install-kr1kq54r/mecab/\n        Complete output (10 lines):\n        /bin/sh: 1: mecab-config: not found\n        Traceback (most recent call last):\n            File <span class=\"hljs-string\">\"&#x3C;string>\"</span>, line 1, <span class=\"hljs-keyword\">in</span> &#x3C;module>\n            File <span class=\"hljs-string\">\"/tmp/pip-install-kr1kq54r/mecab/setup.py\"</span>, line 53, <span class=\"hljs-keyword\">in</span> &#x3C;module>\n            include_dirs=cmd2(<span class=\"hljs-string\">\"mecab-config --inc-dir\"</span>),\n            File <span class=\"hljs-string\">\"/tmp/pip-install-kr1kq54r/mecab/setup.py\"</span>, line 19, <span class=\"hljs-keyword\">in</span> cmd2\n            <span class=\"hljs-built_in\">return</span> cmd1(strings).split()\n            File <span class=\"hljs-string\">\"/tmp/pip-install-kr1kq54r/mecab/setup.py\"</span>, line 15, <span class=\"hljs-keyword\">in</span> cmd1\n            <span class=\"hljs-built_in\">return</span> os.popen(strings).readlines()[0].rstrip()\n        IndexError: list index out of range\n        ----------------------------------------\n    ERROR: Command errored out with <span class=\"hljs-built_in\">exit</span> status 1: python setup.py egg_info Check the logs <span class=\"hljs-keyword\">for</span> full <span class=\"hljs-built_in\">command</span> output.\n    !     Push rejected, failed to compile Python app.\n    !     Push failed</code></pre>\n<p>こんな感じに怒られるわけですよ...orz</p>\n<h2>悪さをするのはMecabだった！？</h2>\n<p>どうやら悪さをしていたのは、<strong>MeCab</strong>だったようです。再度requirements.txtの一部を確認します。</p>\n<pre><code class=\"hljs language-bash\">requirements.txt   |\n----------------------------\ncertifi==2020.6.20\nchardet==3.0.4\nclick==7.1.2\nFlask==1.1.2\ngunicorn==20.0.4\nidna==2.10\nitsdangerous==1.1.0\nJinja2==2.11.2\nMarkupSafe==1.1.1\nmecab==0.996.2\n..................</code></pre>\n<p>どうやら調べてみると、このmecabで指定しているのがよくないみたいですね...</p>\n<p>というわけで、この<strong>mecab==0.996.2</strong>というのをどかしてやりますね。どうするかと言いますと、<br>\n<strong>mecab-python</strong>に変えてあげます。特にバージョンは指定しなくてもよかったです。</p>\n<p>ということで直します。</p>\n<pre><code class=\"hljs language-bash\">requirements.txt   |\n----------------------------\n..................\n..................\nmecab-python       <span class=\"hljs-comment\"># mecab==0.996.2 を修正</span>\n..................</code></pre>\n<p>これでうまくいくはずです！！</p>\n<p>もしうまくいかなかったら、打ち損じとか全角になってないか、他のライブラリでのエラー等を疑うといいと思います。</p>\n<p>これぬまにハマりそうなので、同じエラーに悩む人がいたら是非参考にしてください。</p>\n","Title":"HerokuにMecCabインストールで困った!!","Date":"2020-08-05","Category":"Python","Tags":["Python","MeCab"],"Authors":"ゆうぼう","Slug":"heroku-mecab","Description":"MeCabを利用したWebアプリケーションをHerokuにデプロイしようとして、環境をrequirements.txtにまとめていたのですが、、、どうしてもエラーが出てインストールが止まってしまうことがありました。原因は、Mecabだったようなので、エラー回避方法を共有します。","Published":true},{"contentHtml":"<p>ロジスティック回帰をscikit-learnで実装していると、デフォルトはL2正則化でペナルティを与えています。</p>\n<p>そこで、もっとスパースにしてやろうとL1正則化を行おうとしたのだが、エラーを吐かれた。その時の解決策を共有します。</p>\n<h2>エラーを吐かれた時のバージョン</h2>\n<p>一応最近開発が立て込んでいるので、Anacondaを使って開発環境を分けているのですが、</p>\n<pre><code class=\"hljs language-bash\">(base)$ conda activate ML\n(ML)$ conda list    (pip listでも行ける)\n......\n......\nscikit-learn           0.23.1    \n......</code></pre>\n<p>ということで、scikit-learnのバージョンは<em>0.23.1</em>でした。</p>\n<h2>実装してみる</h2>\n<p>それでは実装してみます。至ってシンプルなスクリプトで動く想定でやっていきます。こちらで変化させるハイパーパラメータは以下になります。</p>\n<table>\n<thead>\n<tr>\n<th>パラメータ</th>\n<th>値</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>C(正則化のつよさ)</td>\n<td>1(デフォルト)</td>\n</tr>\n<tr>\n<td>penalty</td>\n<td>L1正則化</td>\n</tr>\n<tr>\n<td>max_iter(イテレーションの上限)</td>\n<td>100000</td>\n</tr>\n</tbody>\n</table>\n<p>また、訓練データ(X_train, y_train)とテストデータ(X_test, y_test)に分けてあることにします。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> sklearn.linear_model <span class=\"hljs-keyword\">import</span> LogisticRegression\n\nlr_l1 = LogisticRegression(penalty=<span class=\"hljs-string\">'l1'</span>, max_iter=<span class=\"hljs-number\">100000</span>).fit(X_train, y_train)</code></pre>\n<p>するとこんなエラーが返ってきます。</p>\n<pre><code class=\"hljs language-bash\">~/opt/anaconda3/envs/ML/lib/python3.6/site-packages/sklearn/linear_model/_logistic.py <span class=\"hljs-keyword\">in</span> fit(self, X, y, sample_weight)\n1302         The SAGA solver supports both float64 and float32 bit arrays.\n1303         <span class=\"hljs-string\">\"\"</span><span class=\"hljs-string\">\"\n-> 1304         solver = _check_solver(self.solver, self.penalty, self.dual)\n1305 \n1306         if not isinstance(self.C, numbers.Number) or self.C &#x3C; 0:\n\n~/opt/anaconda3/envs/ML/lib/python3.6/site-packages/sklearn/linear_model/_logistic.py in _check_solver(solver, penalty, dual)\n441     if solver not in ['liblinear', 'saga'] and penalty not in ('l2', 'none'):\n442         raise ValueError(\"</span>Solver %s supports only <span class=\"hljs-string\">'l2'</span> or <span class=\"hljs-string\">'none'</span> penalties, <span class=\"hljs-string\">\"\n--> 443                          \"</span>got %s penalty.<span class=\"hljs-string\">\" % (solver, penalty))\n444     if solver != 'liblinear' and dual:\n445         raise ValueError(\"</span>Solver %s supports only <span class=\"hljs-string\">\"\n\nValueError: Solver lbfgs supports only 'l2' or 'none' penalties, got l1 penalty.</span></code></pre>\n<p>ファイルのありかは人それぞれですが、エラーは返ってきます。<br>\nデフォルトの<strong>Solverがlbfgs</strong>に変わっていたそうで、l2またはnoneしかペナルティをサポートしていないそうです。</p>\n<p>というわけで、Solverに<strong>liblinear</strong>を指定しないといけないようですね。</p>\n<h2>liblinearを指定する</h2>\n<p>先ほどのエラーをなくすため、新たにパラメータを足します。</p>\n<table>\n<thead>\n<tr>\n<th>パラメータ</th>\n<th>値</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>C(正則化のつよさ)</td>\n<td>1(デフォルト)</td>\n</tr>\n<tr>\n<td>penalty</td>\n<td>L1正則化</td>\n</tr>\n<tr>\n<td>max_iter(イテレーションの上限)</td>\n<td>100000</td>\n</tr>\n<tr>\n<td>solver</td>\n<td>liblinear</td>\n</tr>\n</tbody>\n</table>\n<p>では足します。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> sklearn.linear_model <span class=\"hljs-keyword\">import</span> LogisticRegression\n\nlr_l1 = LogisticRegression(penalty=<span class=\"hljs-string\">'l1'</span>, solver=<span class=\"hljs-string\">'liblinear'</span>, max_iter=<span class=\"hljs-number\">100000</span>).fit(X_train, y_train)</code></pre>\n<p>これで無事動くようになりました!!!</p>\n<h2>まとめ</h2>\n<p>まとめです。<br>\nscikit-learnを用いて、ロジスティック回帰を使う時、さらにL1正則化をかけたい時は**solver='liblinear'**を引数に追加しましょう。</p>\n<p>この周りは色々と変化が早いので、本を買う際にも初版等も確認しつつ買った方が良い気がしました。バージョン確認も大切に。</p>\n","Title":"ロジスティック回帰でL1正則化を利用できない問題の解決法","Date":"2020-08-01","Category":"Python","Tags":["ML","Python","Scikit-learn"],"Authors":"ゆうぼう","Slug":"logistic-with-l1","Thumbnail":"/images/thumbnails/network.jpg","Description":"ロジスティック回帰をscikit-learnで実装していると、デフォルトはL2正則化でペナルティを与えています。そこで、もっとスパースにしてやろうとL1正則化を行おうとしたのだが、エラーを吐かれた。その時の解決策を共有します。","Published":true},{"contentHtml":"<p>一応参考書通りに学習するのだが、基本的にはいつも最新版をインストールして使う人間なもので、Warning及びErrorとの戦いはよくあることです。ので、Warningとかが出るとうっと身構えてしまうので、困らないように備忘録かつ反面教師として残しておきます。</p>\n<h2>とりあえずmake_forge()をやってみようか</h2>\n<p>とりあえずmake_forge()でforgeデータを生成し、Warningさせてみますかね。。。</p>\n<p>ライブラリはmglearnを使うのでpip環境がある人は、<strong>pip install mglearn</strong>をしてください。その上で、</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mglearn    <span class=\"hljs-comment\"># mglearnのインポート</span>\nX, y = mglearn.datasets.make_forge()    <span class=\"hljs-comment\"># make_forgeメソッドで生成</span></code></pre>\n<p>以下がアウトプットです。</p>\n<pre><code class=\"hljs language-bash\">/Users/user/opt/anaconda3/envs/ML/lib/python3.6/site-packages/sklearn/utils/deprecation.py:86: FutureWarning: Function make_blobs is deprecated; Please import make_blobs directly from scikit-learn\nwarnings.warn(msg, category=FutureWarning)</code></pre>\n<p>なんだかWarningで怒られましたorz</p>\n<p>将来的にsklearn.datasets.makeblobs()と被るよってことを言いたいらしいです。<em>scikit-learnから直接make_blobsをインポートしろ</em>とか言ってますね。\n次からWarningを避けて行きます。</p>\n<h2>make_blobsに乗り換える</h2>\n<p>make_blobsメソッドに乗り換えて行きます。これはscikit-learnのdatasetsモジュールに含まれているみたいなので、こいつをインポートして行きます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> sklearn.datasets <span class=\"hljs-keyword\">import</span> make_blobs    <span class=\"hljs-comment\"># これでインポート完了</span></code></pre>\n<p>インポートがうまくいったら次はメソッドを呼び出します。</p>\n<pre><code class=\"hljs language-python\">X, y = make_blobs()</code></pre>\n<p>これでデータがうまく生成されたようです。無事Warningも出てきません!!!\n念のため、Xの型をみて行きます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"X.shape: {}\"</span>.<span class=\"hljs-built_in\">format</span>(X.shape))\n\n<span class=\"hljs-comment\"># -> X.shape: (100, 2)</span></code></pre>\n<p>詰まるところ、2つの特徴量を持つデータが100個生成されました。100*2の行列ですね。\nmake_forge()のときは2つの特徴量のデータが26個を期待していたようなので、データ量が増えたみたいですね。</p>\n<h2>まとめ</h2>\n<p>mglearn.datasets.make_forge()でWarningを回避する方法のまとめがこちらです。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> sklearn.datasets <span class=\"hljs-keyword\">import</span> make_blobs    <span class=\"hljs-comment\"># インポート</span>\nX, y = make_blobs()    <span class=\"hljs-comment\"># make_blobsメソッドの実行</span>\n\n<span class=\"hljs-string\">\"\"\"\n確認のおまけ\n\"\"\"</span>\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">\"X.shape: {}\"</span>.<span class=\"hljs-built_in\">format</span>(X.shape))\n\n<span class=\"hljs-comment\">#-> X.shape: (100, 2)    # 特徴量を2つ持つ100個のデータ</span></code></pre>\n<p>scikit-learn周りは、アップデートが早いので少し古い技術書なだけでも、Future Warningが出たり、Errorが出たりすることが多々あります。\n気をつけながら学習をする必要がありそうですね。では、今回はここまで！</p>\n","Title":"scikit-learnのmake_blobsに乗り換えよう!!","Date":"2020-07-21","Category":"Python","Tags":["ML","Python","Scikit-learn"],"Authors":"ゆうぼう","Slug":"prefer-to-make_blobs","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonではじめる機械学習をやっている最中に、mglearnというライブラリからmake_forge()メソッドでデータを生成することがあったのですが、Warningが出て怒られたので、推奨される形に戻すために互換性のあるコードに直します。","Published":true},{"contentHtml":"<p>MySQLのデータベースを扱う際に、Pythonスクリプトから接続したくなったので、Pythonからの接続方法を紹介します。</p>\n<h2>mysql-connector-pythonのインストール</h2>\n<p>まずは、mysql-connector-pythonのインストールを行っていきます。(復習がてら)</p>\n<p>今回は、pipを使ってインストールしていきます。</p>\n<pre><code class=\"hljs language-bash\">$~ pip install mysql-connector-python</code></pre>\n<p>これでエラーが出ずに進めばインストールできているはずです。とりあえずこれで準備は完了。</p>\n<h2>まずはconnectorをインポート</h2>\n<p>まずは接続するためのメソッドをインポートしないと使えないので、インポートしましょう。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mysql.connector</code></pre>\n<p>これで準備はOK!!</p>\n<h2>接続とDB操作のためのカーソルを生成、そして切断</h2>\n<p>今回の例では、以下の情報を前提にした上で、exampleというデータベースに直で接続していきます。</p>\n<table>\n<thead>\n<tr>\n<th>user</th>\n<th>host</th>\n<th>password</th>\n<th>database</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>root</td>\n<td>127.0.0.1</td>\n<td>example</td>\n<td>example</td>\n</tr>\n</tbody>\n</table>\n<p>さて、早速接続の処理を書いてみましょう。</p>\n<pre><code class=\"hljs language-python\">cnx = mysql.connector.connect(\n    user=<span class=\"hljs-string\">'root'</span>,\n    password=<span class=\"hljs-string\">'example'</span>,\n    database=<span class=\"hljs-string\">'example'</span>,\n)</code></pre>\n<p>これだけで接続は完了です。（パスワード等が全て正しければ）<br>\nホストはデフォルトが127.0.0.1なので書かなくていいです。</p>\n<p>この後に、カーソルをあてます。</p>\n<pre><code class=\"hljs language-python\">cur = cnx.cursor()</code></pre>\n<p>この処理だけでオッケーです。</p>\n<p>他の処理等も終わったら、しっかり切断しておきましょう。</p>\n<pre><code class=\"hljs language-python\">cur.close()\ncnx.close()</code></pre>\n<p>これで接続と切断の処理は完了です。</p>\n<h2>SHOW TABLE表示していく</h2>\n<p>それでは、ここまでで準備は整ったので、*cur = cnx.cursor()*のすぐ後に以下の処理を書いてみましょう。</p>\n<pre><code class=\"hljs language-python\">sql = <span class=\"hljs-string\">\"SHOW TABLES\"</span>    <span class=\"hljs-comment\">#命令文</span>\n<span class=\"hljs-built_in\">print</span>(cur.execute(sql))    <span class=\"hljs-comment\">#結果の出力</span>\n\n<span class=\"hljs-comment\"># --> None    #あれ？？ない</span></code></pre>\n<p>見事失敗ですね(笑)</p>\n<p>僕はずっと、実行した結果が戻り値として吐き出されていると思ってこの処理を書きました。しかし、それがないので<em>None</em>が返ってきてしまうのですね...</p>\n<p>それでは正しいスクリプトを書いていきましょう。</p>\n<pre><code class=\"hljs language-python\">sql = <span class=\"hljs-string\">\"SHOW TABLES\"</span>    <span class=\"hljs-comment\">#命令文</span>\ncur.execute(sql)    <span class=\"hljs-comment\">#実行</span>\n<span class=\"hljs-built_in\">print</span>(cur.fetchone())    <span class=\"hljs-comment\">#1つだけフェッチする</span>\n\n<span class=\"hljs-comment\"># --> (example, )</span></code></pre>\n<p>出力本体は人の環境によって異なりますが、このような感じでタプル型でテーブル名が出力されます。</p>\n<p>複数処理結果をまとめて吐き出すには「<strong>fetchall()</strong>」というものがあるようです。今回は一つだけテーブルに対して情報を吐いてもらうので「<strong>fetchone()</strong>」で取得しました。</p>\n<h2>せっかくなので'SHOW DATABASES'もやってみる</h2>\n<p>せっかくなので「<strong>SHOW DATABASES</strong>」も出力してみましょう。DATABASE群をみるので、今回接続する際は先ほどのdatabase引数はなくします。</p>\n<table>\n<thead>\n<tr>\n<th>user</th>\n<th>host</th>\n<th>password</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>root</td>\n<td>127.0.0.1</td>\n<td>example</td>\n</tr>\n</tbody>\n</table>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mysql.connector\n\ncnx = mysql.connector.connect(\n    user=<span class=\"hljs-string\">'root'</span>,\n    password=<span class=\"hljs-string\">'example'</span>,\n    )\n\ncur = cnx.cursor()\n\ncur.execute(<span class=\"hljs-string\">\"SHOW DATABASES\"</span>)\n<span class=\"hljs-built_in\">print</span>(cur.fetchall())    <span class=\"hljs-comment\">#&#x3C;&#x3C; fetchall()に注意</span>\n\ncur.close()\ncnx.close()\n\n<span class=\"hljs-comment\"># --> [(example, ), (sys, )]</span></code></pre>\n<p>今回は複数のデータがあることに留意したとして、**fetchall()**しました。ここも見落としポイントが多い気がします。</p>\n<p>僕はそうだったのですが、タプル型に全ての名前が入ると期待したのですが、実際は一つ一つの名前に対してタプルを作り、そのタプル群をリストに入れるようです。</p>\n<h2>まとめ</h2>\n<p>ここまでみてきた結果、一番安全なのはこれでしょうか。</p>\n<pre><code class=\"hljs language-python\">cur = cnx.cursor()\n\ncur.execute(<span class=\"hljs-string\">\"SHOW DATABASES\"</span>)\n<span class=\"hljs-built_in\">print</span>(cur.fetchall()) </code></pre>\n<p>まずはカーソルを当ててから、そこでコマンドを実行する。そのあとは「<strong>fetchall()</strong>」でリストに包める。</p>\n<p>情報が1つしかないことがわかっているならば問題ないのですが、基本的には複数あるという想定のもと、fetchall()で取得する方がいい気もしました。</p>\n","Title":"mysql-connector-pythonで'SHOW ~~~'に困ったのでその対処法","Date":"2020-07-14","Category":"Python","Tags":["MySQL","Python"],"Authors":"ゆうぼう","Slug":"show_tables-mysql-python","Thumbnail":"/images/thumbnails/database.jpg","Description":"Pythonのライブラリ「mysql-connector-python」を使っていたのですが、なかなか'SHOW TABLES'や'SHOW DATABASES'を出力できなかったので、その対処法を備忘録としてまとめます。","Published":true},{"contentHtml":"<p>MySQLのデータベースを扱う際に、Pythonスクリプトから接続したくなったので、Pythonからの接続方法を紹介します。</p>\n<h2>mysql-connector-pythonのインストール</h2>\n<p>まずは、mysql-connector-pythonのインストールを行っていきます。</p>\n<p>今回は、pipを使ってインストールしていきます。</p>\n<pre><code class=\"hljs language-bash\">$~ pip install mysql-connector-python</code></pre>\n<p>これでエラーが出ずに進めばインストールできているはずです。とりあえずこれで準備は完了。</p>\n<h2>まずはconnectorをインポート</h2>\n<p>まずは接続するためのメソッドをインポートしないと使えないので、インポートしましょう。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mysql.connector</code></pre>\n<p>これで準備はOK!!</p>\n<h2>接続と切断</h2>\n<p>それではここまで完成できていれば、あとは接続の処理を書くだけです。</p>\n<p>今回の例では、以下の情報を前提にしてみます。</p>\n<table>\n<thead>\n<tr>\n<th>user</th>\n<th>host</th>\n<th>password</th>\n<th>database</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>root</td>\n<td>127.0.0.1</td>\n<td>**********</td>\n<td>example</td>\n</tr>\n</tbody>\n</table>\n<p>さて、早速接続の処理を書いてみましょう。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mysql.connectorcnx = mysql.connecor.connect(\n        user=<span class=\"hljs-string\">'root'</span>,\n        host=<span class=\"hljs-string\">'127.0.0.1'</span>,\n        password=<span class=\"hljs-string\">'**********'</span>,\n        database=<span class=\"hljs-string\">'example'</span>,\n    )</code></pre>\n<p>これだけで接続は完了です。（パスワード等が全て正しければ）</p>\n<p>他の処理等も終わったら、しっかり切断しておきましょう。</p>\n<pre><code class=\"hljs language-python\">    cnx.close()</code></pre>\n<p>これで接続と切断の処理は完了です。</p>\n<p>また、hostが127.0.0.1であることは、他のポートとぶつかっているために人為的にローカルホストやポート番号を変えていなければ、デフォルトの位置になっているはずなので、以下でも実行可能です。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mysql.connectorcnx = mysql.connecor.connect(\n        user=<span class=\"hljs-string\">'root'</span>,\n        host=<span class=\"hljs-string\">'127.0.0.1'</span>,\n        password=<span class=\"hljs-string\">'**********'</span>,\n        database=<span class=\"hljs-string\">'example'</span>,\n    cnx = mysql.connecor.connect(\n        user=<span class=\"hljs-string\">'root'</span>,\n        password=<span class=\"hljs-string\">'**********'</span>,\n        database=<span class=\"hljs-string\">'example'</span>,\n    )</code></pre>\n<h2>connectの引数の内容を辞書にまとめておく</h2>\n<p>先ほど、引数に入力した情報を辞書にまとめて接続することもできます。\n以下のようなスクリプトになります。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mysql.connector\n\n    config = {\n        user: <span class=\"hljs-string\">'root'</span>,\n        host: <span class=\"hljs-string\">'127.0.0.1'</span>,\n        password: <span class=\"hljs-string\">'**********'</span>,\n        database: <span class=\"hljs-string\">'example'</span>,\n    }\n    cnx = mysql.connector.connect(**config)\n\n    cnx.close()</code></pre>\n<p>configは辞書型なので、「**」でアンパックすることも忘れないようにしましょう。</p>\n<h2>まとめ</h2>\n<p>最終的にまとめると、流れはこんな感じです。</p>\n<h2>#辞書使わない</h2>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mysql.connector\n\ncnx = mysql.connecor.connect(\n    user=&#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">strings</span>\">'<span class=\"hljs-title\">root</span>',\n    <span class=\"hljs-title\">host</span>=&#x3C;<span class=\"hljs-title\">span</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">strings</span>\">'127.0.0.1',\n    <span class=\"hljs-title\">password</span>=&#x3C;<span class=\"hljs-title\">span</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">strings</span>\">'**********',\n    <span class=\"hljs-title\">database</span>=&#x3C;<span class=\"hljs-title\">span</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">strings</span>\">'<span class=\"hljs-title\">example</span>',\n)\n\n<span class=\"hljs-title\">cnx</span>.<span class=\"hljs-title\">close</span>()</span></code></pre>\n<h2>#辞書型</h2>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> mysql.connector\n\nconfig = {\n    user: &#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">strings</span>\">'<span class=\"hljs-title\">root</span>',\n    <span class=\"hljs-title\">host</span>:</span> &#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">strings</span>\">'127.0.0.1',\n    <span class=\"hljs-title\">password</span>:</span> &#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">strings</span>\">'**********',\n    <span class=\"hljs-title\">database</span>:</span> &#x3C;span <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">strings</span>\">'<span class=\"hljs-title\">example</span>',\n}\n<span class=\"hljs-title\">cnx</span> = <span class=\"hljs-title\">mysql</span>.<span class=\"hljs-title\">connector</span>.<span class=\"hljs-title\">connect</span>(<span class=\"hljs-params\">**config</span>)\n\n<span class=\"hljs-title\">cnx</span>.<span class=\"hljs-title\">close</span>()</span></code></pre>\n<p>後ほど、テーブルを実際に作ったり、インサートしたりの方法を紹介しようと思います。</p>\n","Title":"mysql-connector-pythonでローカルDBに接続する","Date":"2020-07-13","Category":"Python","Tags":["MySQL","Python"],"Authors":"ゆうぼう","Slug":"connect-to-mysql-python","Thumbnail":"/images/thumbnails/database.jpg","Description":"Pythonのライブラリ「mysql-connector-python」を使って、ローカルのMySQLデータベースに接続します。","Published":true}],"category":"Python","categories":["Web","JavaScript","Competition","Cloud","Linux","Python","ML","Go","SQL"],"tags":["Apache","Appium","atmaCup","AWS","CentOS7","CentOS8","Colab","conda","CSS","ffmpeg","Flask","Go","Google Colaboratory","Heroku","HTML","JavaScript","JSON","Kaggle","Linux","Mac","make","map","MeCab","ML","MySQL","NLP","node.js","Pandas","Python","Pytorch","pytorch-lightning","Scikit-learn","Selenium","subprocess","tensorflow","Tkinter","zsh","オブジェクト指向","デコレータ","データ分析","特殊メソッド"],"page":2},"__N_SSG":true}