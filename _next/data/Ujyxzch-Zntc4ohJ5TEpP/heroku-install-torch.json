{"pageProps":{"postData":{"contentHtml":"<p>対話システムをサーバ上で動かせる体制を作るために，pytorchやら何やらをHerokuでinstallさせる必要があったのですが，**pytorchちょっとデカすぎませんか？**という状態でエラーが出てしまいました．その時の解消法です．</p>\n<h2>Pytorchデカすぎませんか？</h2>\n<p>Herokuはデプロイ時には，500MBに収まる必要があるのですが，<br>\nまさかのpytorchは<strong>831.4 MB</strong>.</p>\n<p>は？</p>\n<p><img src=\"/images/article/torch-weight.png\" alt=\"Pytorchの容量\"></p>\n<p>正直焦りました．</p>\n<p>躓くところ，そことは想定していなかったので（笑）</p>\n<p>なんとか500MBに収める方法次に紹介します．</p>\n<h2>【解消法】 CPUのみ対応版をinstallさせる</h2>\n<p>色々調べてみたところ，原因は，<strong>CPU/GPU両対応のため色々入って重い</strong>ことらしいです．</p>\n<p>そういうことなので，CPUのみに対応させることにしました．(HerokuもCPUしか動作させられないので...)</p>\n<p>requirements.txtを多少工夫します．</p>\n<h3>変更前のrequirements.txt</h3>\n<pre><code class=\"hljs language-python\">...\ntorch==<span class=\"hljs-number\">1.9</span><span class=\"hljs-number\">.0</span>\n...\n</code></pre>\n<h3>変更後のrequirements.txt</h3>\n<p>インターネット上のファイルを参照させます．</p>\n<pre><code class=\"hljs language-python\">-f https://download.pytorch.org/whl/torch_stable.html\ntorch==<span class=\"hljs-number\">1.9</span><span class=\"hljs-number\">.0</span>+cpu\n</code></pre>\n<p>こうすることで，どうしてもサイズがでかいままですが，元よりはかなり圧縮できました．</p>\n<p><img src=\"/images/article/torch-cpu-weight.png\" alt=\"Pytorch軽量後の容量\"></p>\n<p>831.4 → 175.5ダウンなので，かなり軽量化した感じがします．</p>\n<h2>やってみたけどダメだったこと</h2>\n<p>上記のCPUのみ対応版にする前にやってみたが，ダメだったことがあります．</p>\n<p>デプロイ後に，「<em>pip install torch</em>」を含むrun.shを走らせてインストールさせることです．</p>\n<p>うまくいくと思ったのですが，重すぎてOut of Memoryでした...</p>","Title":"Pytorch, Herokuにはデカすぎる問題","Date":"2021-09-30","Category":"Python","Tags":["Heroku"],"Authors":"ゆうぼう","Slug":"heroku-install-torch","Thumbnail":"/images/thumbnails/heroku-install-torch.png","Description":"対話システムをサーバ上で動かせる体制を作るために，pytorchやら何やらをHerokuでinstallさせる必要があったのですが，pytorchちょっとデカすぎませんか？という状態でエラーが出てしまいました．その時の解消法です．","Published":true},"categories":["論文","Web","JavaScript","Competition","Cloud","Python","Linux","ML","Go","SQL"],"tags":["Apache","Appium","ASR","atmaCup","AWS","brew","CentOS7","CentOS8","Colab","COMET","commonsense","conda","Contrasive Learning","Contrastive Learning","CSS","Demo","Dialogue Structure Learning","dialogue system","DST","Emotion Recognition","empathetic dialogue system","encyclopedic","Error Correction","ESPNet","ffmpeg","Flask","Gating Mechanism","Go","Google Colaboratory","Heroku","Highway Transformer","HTML","humor detection","Intent Classification","Internet-Augmented","JavaScript","JSON","Kaggle","KC-Net","knowledge-base","Knowledge-Intensive NLP","laughter","Linux","LLM","Mac","make","map","MeCab","mental health","mental state knowledge","mentalisation","MentalRoBERTa","Merging Models","ML","Model Editing","Model Patching","MT","Multi-Hop Transformer","multi-modal","MySQL","NLG","NLI","NLP","Node","node.js","npm","Overleaf","Pandas","persona","PLMKE","Poetry","Prompt-Tuning","Python","Pytorch","pytorch-lightning","Scikit-learn","Selenium","Self-Dependency-Units (SDU)","shared laughter","SISR","SLU","Speech Disfluency","subprocess","Super-Resolution","survey","tensorflow","Tkinter","Transfer Learning","transformer","Weight Interpolation","zsh","オブジェクト指向","デコレータ","データ分析","特殊メソッド","聞き手反応","論文執筆","超解像"]},"__N_SSG":true}