{"pageProps":{"postData":{"contentHtml":"<p>Pythonで中身をpopで削除したいなーと思った時、なぜか「<em>dictionary changed size during iteration</em>」とのメッセージが。これは意外と出てきたら原因がパッとしないので、2度と同じことを起こさないように記録しておきます。</p>\n<h2>直感的にイテレーションしてpopしていく</h2>\n<p>ここでは、直感的に初心者が思いつきそうな感じのイテレーションを用いてループを回し、popで辞書を消していきます。</p>\n<pre><code class=\"hljs language-python\">dictionary = {\n    <span class=\"hljs-string\">'a'</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">'b'</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">'c'</span>: <span class=\"hljs-number\">2</span>,\n}\n\n<span class=\"hljs-keyword\">for</span> key <span class=\"hljs-keyword\">in</span> dictionary.keys():\n    dictionary.pop(key)\n</code></pre>\n<p>結果はこんな感じに...</p>\n<pre><code class=\"hljs language-bash\">Traceback (most recent call last):\n  File <span class=\"hljs-string\">\"&#x3C;stdin>\"</span>, line 6, <span class=\"hljs-keyword\">in</span> &#x3C;module>\nRuntimeError: dictionary changed size during iteration\n</code></pre>\n<p>は？<em>RuntimeError</em>だと...!?</p>\n<p><strong>イテレーション中に辞書のサイズ変わったんですけど</strong>と怒られたわけです。</p>\n<p>ということは、<strong>keys()を使っていながら、ループの内部で辞書をいじってはいけない</strong>ということになりますね。</p>\n<h2>keys()をリストとして先に確保してしまえ!!</h2>\n<p>さて、解決していきます。</p>\n<p>イテレーション中の辞書を書き換えてはいけなかったので、*list()*にしてしまお〜〜<br>\nということで、キーのイテレータは配列として別物と扱わせます。</p>\n<p>少しだけ変えた奴が下。</p>\n<pre><code class=\"hljs language-python\">dictionary = {\n    <span class=\"hljs-string\">'a'</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">'b'</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">'c'</span>: <span class=\"hljs-number\">2</span>,\n}\n\n<span class=\"hljs-keyword\">for</span> key <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">list</span>(dictionary.keys()):    &#x3C;=変えるのはここ\n    dictionary.pop(key)\n</code></pre>\n<p>これで、出力も足してみます。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-built_in\">print</span>(a)\n</code></pre>\n<p>結果が以下になります。</p>\n<pre><code class=\"hljs language-bash\">1\n</code></pre>\n<p>お〜動きましたね。</p>\n<p>というわけで、辞書型でイテレーションを用いて何かするときは、配列とかで切り離して使ってあげるとエラーなくコードが動きますよ〜</p>\n<p>今後は僕も気をつけたいと思います。</p>","Title":"dictionary changed size during iterationの原因特定した","Date":"2020-10-18","Category":"Python","Tags":"Python","Authors":"ゆうぼう","Slug":"py-dict-iter-err","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonで中身をpopで削除したいなーと思った時、なぜか「dictionary changed size during iteration」とのメッセージが。これは意外と出てきたら原因がパッとしないので、2度と同じことを起こさないように記録しておきます。","Published":true},"categories":["論文","Web","JavaScript","Competition","Cloud","Linux","Python","ML","Go","SQL"],"tags":["Apache","Appium","atmaCup","AWS","CentOS7","CentOS8","Colab","COMET","commonsense","conda","Contrasive Learning","Contrastive Learning","CSS","Dialogue Structure Learning","dialogue system","DST","empathetic dialogue system","encyclopedic","ESPNet","ffmpeg","Flask","Gating Mechanism","Go","Google Colaboratory","Heroku","Highway Transformer","HTML","humor detection","Internet-Augmented","JavaScript","JSON","Kaggle","KC-Net","knowledge-base","Knowledge-Intensive NLP","laughter","Linux","Mac","make","map","MeCab","mental health","mental state knowledge","mentalisation","MentalRoBERTa","ML","MT","Multi-Hop Transformer","multi-modal","MySQL","NLG","NLI","NLP","Node","node.js","npm","Pandas","persona","PLMKE","Poetry","Prompt-Tuning","Python","Pytorch","pytorch-lightning","Scikit-learn","Selenium","Self-Dependency-Units (SDU)","shared laughter","SISR","subprocess","Super-Resolution","survey","tensorflow","Tkinter","transformer","zsh","オブジェクト指向","デコレータ","データ分析","特殊メソッド","聞き手反応","超解像"]},"__N_SSG":true}