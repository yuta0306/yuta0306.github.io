{"pageProps":{"postData":{"contentHtml":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/katex@0.15.0/dist/katex.min.css\">\n</head>\n<body>\n<p>Pythonで他にはない特殊な書き方といえば、<strong>内包表記</strong>ですかね。Haskellでもかけるみたいな話聞いたことあるけど。実際内包表記は読みやすく、たいてい高速に動くので推奨される書き方と思います。ベンチマークを測ってみたので参考になればと。</p>\n<h2>今回のコード</h2>\n<p>今回速さを測るための指標となるコードは以下になります。</p>\n<p>至ってシンプルなforループが以下です。</p>\n<pre><code class=\"hljs language-python\">symbols = <span class=\"hljs-string\">'$¢£¥€¤'</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">non_ascii</span>(<span class=\"hljs-params\">c</span>):\n    <span class=\"hljs-keyword\">return</span> c > <span class=\"hljs-number\">127</span>\ncodes = []\n<span class=\"hljs-keyword\">for</span> s <span class=\"hljs-keyword\">in</span> symbols:\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">ord</span>(s) > <span class=\"hljs-number\">127</span>:\n        codes.append(<span class=\"hljs-built_in\">ord</span>(s))\n</code></pre>\n<p>これを下に複数の書き方に対して処理速度を測ります。</p>\n<h2>いざ実験</h2>\n<p>今回試すものが以下になります。</p>\n<ol>\n<li>ただのforループ</li>\n<li>内包表記</li>\n<li>内包表記 + 自作関数(non_adcii)</li>\n<li>filter + lambda</li>\n<li>filter + 自作関数(non_ascii)</li>\n</ol>\n<p>これらに関して測ってみます。\nコードが以下になります。</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">import</span> timeit\nTIMES = <span class=\"hljs-number\">10000</span>\nSETUP = <span class=\"hljs-string\">\"\"\"\nsymbols = '$¢£¥€¤'\ndef non_ascii(c):\n    return c > 127\n\"\"\"</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">clock</span>(<span class=\"hljs-params\">label, cmd</span>):\n    res = timeit.repeat(cmd, setup=SETUP, number=TIMES)\n    <span class=\"hljs-built_in\">print</span>(label, *(<span class=\"hljs-string\">'{:.3f}'</span>.<span class=\"hljs-built_in\">format</span>(x) <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> res))\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">\"__main__\"</span>:\n    clock(<span class=\"hljs-string\">'for-loop        :'</span>, <span class=\"hljs-string\">'codes = []\\nfor s in symbols:\\n\\tif ord(s) > 127: codes.append(ord(s))\\ncodes'</span>)\n    clock(<span class=\"hljs-string\">'listcomp        :'</span>, <span class=\"hljs-string\">'[ord(s) for s in symbols if ord(s) > 127]'</span>)\n    clock(<span class=\"hljs-string\">'listcomp + func :'</span>, <span class=\"hljs-string\">'[ord(s) for s in symbols if non_ascii(ord(s))]'</span>)\n    clock(<span class=\"hljs-string\">'filter + lambda :'</span>, <span class=\"hljs-string\">'list(filter(lambda c: c > 127, map(ord, symbols)))'</span>)\n    clock(<span class=\"hljs-string\">'filter + func   :'</span>, <span class=\"hljs-string\">'list(filter(non_ascii, map(ord, symbols)))'</span>)\n</code></pre>\n<p>これらから得られる結果がこんな感じです。(人による)</p>\n<pre><code class=\"hljs language-bash\">for-loop        : 0.009 0.009 0.009 0.009 0.009\nlistcomp        : 0.008 0.008 0.008 0.008 0.008\nlistcomp + func : 0.012 0.013 0.013 0.012 0.012\nfilter + lambda : 0.011 0.013 0.012 0.011 0.013\nfilter + func   : 0.014 0.014 0.014 0.014 0.013\n</code></pre>\n<p>これはまだループも小さいので差はありませんが、安定して早く動いているのは<strong>内包表記</strong>ですね。</p>\n<p>読みやすく、高速に動くことが多い内包表記でした。実際に導入してみてはいかがでしょか。</p>\n<p>今回は実験だけ示して終わります〜〜.</p>\n</body>\n</html>\n","Title":"内包表記でパフォーマンスをあげるのだ！","Date":"2020-11-22","Category":"Python","Tags":["Python"],"Author":"ゆうぼう","Slug":"migrate-listcomp","Thumbnail":"/images/thumbnails/python.jpg","Description":"Pythonで他にはない特殊な書き方といえば、内包表記ですかね。Haskellでもかけるみたいな話聞いたことあるけど。実際内包表記は読みやすく、たいてい高速に動くので推奨される書き方と思います。ベンチマークを測ってみたので参考になればと。","Published":true},"categories":["論文","Web","JavaScript","Competition","Cloud","Linux","Python","ML","Go","SQL"],"tags":["Apache","Appium","atmaCup","AWS","CentOS7","CentOS8","Colab","COMET,mental health,NLP,mental state knowledge,mentalisation,Contrasive Learning,MentalRoBERTa,KC-Net","conda","CSS","dialogue system","dialogue system,Internet-Augmented","dialogue system,knowledge-base","dialogue system,NLI","dialogue system,persona,Prompt-Tuning","dialogue system,survey,DST","ESPNet","ffmpeg","Flask","Go","Google Colaboratory","Heroku","HTML","humor detection,multi-modal","JavaScript","JSON","Kaggle","laughter,shared laughter","Linux","Mac","make","map","MeCab","ML","MT,transformer,Multi-Hop Transformer","MySQL","NLP","Node","node.js","npm","Pandas","Poetry","Python","Pytorch","pytorch-lightning","Scikit-learn","Selenium","SISR","subprocess","Super-Resolution","survey,dialogue system","survey,NLP,knowledge-base,PLMKE,commonsense,encyclopedic,Knowledge-Intensive NLP","tensorflow","Tkinter","transformer,Highway Transformer,Gating Mechanism,Self-Dependency-Units (SDU)","zsh","オブジェクト指向","デコレータ","データ分析","特殊メソッド","超解像"]},"__N_SSG":true}