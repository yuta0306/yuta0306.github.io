{"pageProps":{"postData":{"contentHtml":"<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/katex@0.15.0/dist/katex.min.css\">\n</head>\n<body>\n<p>対話システムをサーバ上で動かせる体制を作るために，pytorchやら何やらをHerokuでinstallさせる必要があったのですが，**pytorchちょっとデカすぎませんか？**という状態でエラーが出てしまいました．その時の解消法です．</p>\n<h2>Pytorchデカすぎませんか？</h2>\n<p>Herokuはデプロイ時には，500MBに収まる必要があるのですが，<br>\nまさかのpytorchは<strong>831.4 MB</strong>.</p>\n<p>は？</p>\n<p><img src=\"/images/article/torch-weight.png\" alt=\"Pytorchの容量\"></p>\n<p>正直焦りました．</p>\n<p>躓くところ，そことは想定していなかったので（笑）</p>\n<p>なんとか500MBに収める方法次に紹介します．</p>\n<h2>【解消法】 CPUのみ対応版をinstallさせる</h2>\n<p>色々調べてみたところ，原因は，<strong>CPU/GPU両対応のため色々入って重い</strong>ことらしいです．</p>\n<p>そういうことなので，CPUのみに対応させることにしました．(HerokuもCPUしか動作させられないので...)</p>\n<p>requirements.txtを多少工夫します．</p>\n<h3>変更前のrequirements.txt</h3>\n<pre><code class=\"hljs language-python\">...\ntorch==<span class=\"hljs-number\">1.9</span><span class=\"hljs-number\">.0</span>\n...\n</code></pre>\n<h3>変更後のrequirements.txt</h3>\n<p>インターネット上のファイルを参照させます．</p>\n<pre><code class=\"hljs language-python\">-f https://download.pytorch.org/whl/torch_stable.html\ntorch==<span class=\"hljs-number\">1.9</span><span class=\"hljs-number\">.0</span>+cpu\n</code></pre>\n<p>こうすることで，どうしてもサイズがでかいままですが，元よりはかなり圧縮できました．</p>\n<p><img src=\"/images/article/torch-cpu-weight.png\" alt=\"Pytorch軽量後の容量\"></p>\n<p>831.4 → 175.5ダウンなので，かなり軽量化した感じがします．</p>\n<h2>やってみたけどダメだったこと</h2>\n<p>上記のCPUのみ対応版にする前にやってみたが，ダメだったことがあります．</p>\n<p>デプロイ後に，「<em>pip install torch</em>」を含むrun.shを走らせてインストールさせることです．</p>\n<p>うまくいくと思ったのですが，重すぎてOut of Memoryでした...</p>\n</body>\n</html>\n","Title":"Pytorch, Herokuにはデカすぎる問題","Date":"2021-09-30","Category":"Python","Tags":["Heroku"],"Authors":"ゆうぼう","Slug":"heroku-install-torch","Thumbnail":"/images/thumbnails/heroku-install-torch.png","Description":"対話システムをサーバ上で動かせる体制を作るために，pytorchやら何やらをHerokuでinstallさせる必要があったのですが，pytorchちょっとデカすぎませんか？という状態でエラーが出てしまいました．その時の解消法です．","Published":true},"categories":["論文","Web","JavaScript","Competition","Cloud","Linux","Python","ML","Go","SQL"],"tags":["Apache","Appium","atmaCup","AWS","CentOS7","CentOS8","Colab","COMET,mental health,NLP,mental state knowledge,mentalisation,Contrasive Learning,MentalRoBERTa,KC-Net","conda","CSS","dialogue system","dialogue system,Internet-Augmented","dialogue system,knowledge-base","dialogue system,NLI","dialogue system,persona,Prompt-Tuning","dialogue system,survey,DST","DST","ESPNet","ffmpeg","Flask","Gating Mechanism","Go","Google Colaboratory","Heroku","Highway Transformer","HTML","humor detection","humor detection,multi-modal","JavaScript","JSON","Kaggle","laughter,shared laughter","Linux","Mac","make","map","MeCab","ML","MT,transformer,Multi-Hop Transformer","multi-modal","MySQL","NLP","Node","node.js","npm","Pandas","Poetry","Python","Pytorch","pytorch-lightning","Scikit-learn","Selenium","Self-Dependency-Units (SDU)","SISR","subprocess","Super-Resolution","survey","survey,dialogue system","survey,NLP,knowledge-base,PLMKE,commonsense,encyclopedic,Knowledge-Intensive NLP","tensorflow","Tkinter","transformer","transformer,Highway Transformer,Gating Mechanism,Self-Dependency-Units (SDU)","zsh","オブジェクト指向","デコレータ","データ分析","特殊メソッド","超解像"]},"__N_SSG":true}