{"pageProps":{"postData":{"contentHtml":"<p>MeCabを利用したWebアプリケーションをHerokuにデプロイしようとして、環境をrequirements.txtにまとめていたのですが、、、どうしてもエラーが出てインストールが止まってしまうことがありました。原因は、Mecabだったようなので、エラー回避方法を共有します。</p>\n<p>前提条件として、</p>\n<ul>\n<li>mecabを<em>pip mecab</em>でインストール済み</li>\n<li>HerokuをCLIでいじる準備ができている</li>\n</ul>\n<h2>とりあえずrequirements.txtを作成</h2>\n<p>まあ、pip listしてまず現環境におけるライブラリをみていきましょう。</p>\n<p>例えばこんな構成だとします。</p>\n<pre><code>(myvenv)$ ~ pip list\nPackage                Version\n---------------------- -------------------\ncertifi                2020.6.20\nchardet                3.0.4\nclick                  7.1.2\nFlask                  1.1.2\ngunicorn               20.0.4\nidna                   2.10\nitsdangerous           1.1.0\nJinja2                 2.11.2\nMarkupSafe             1.1.1\nmecab                  0.996.2\nmysql-connector-python 8.0.21\noauthlib               3.1.0\npip                    20.1.1\nprotobuf               3.12.4\nrequests               2.24.0\nrequests-oauthlib      1.3.0\nsetuptools             49.2.0.post20200714\nsix                    1.15.0\nurllib3                1.25.10\nWerkzeug               1.0.1\nwheel                  0.34.2</code></pre>\n<p>中段くらいにmecabのバージョン0.996.2がありますね。それではこれをもとに、requirements.txtを作成していきます。</p>\n<pre><code>(myvenv)$ ~ pip freeze > requirements.txt</code></pre>\n<p>これで下準備OKです</p>\n<h2>Herokuへログインしてデプロイ</h2>\n<p>それではコマンドラインを開きまして、デプロイしていきましょう。</p>\n<pre><code>$ ~ heroku % login</code></pre>\n<p>これを打つと、認証画面的にブラウザが勝手に開きます。それでログインできていれば、この画面を消してターミナルに戻る旨の内容が書かれています。</p>\n<p>それで、成功したとして、次は</p>\n<pre><code>$ ~ % heroku git:<span>clone</span> -a your-app-name\n$ ~ % <span>cd</span> your-app-directory\n\n$ your-app-directory % git add .\n$ your-app-directorygit % commit -am <span>\"deploy!!\"</span>\n$ your-app-directorygit % push heroku master</code></pre>\n<p>こうするとPythonの場合、<strong>runtime.txt</strong>からPythonのバージョンを、<strong>requirements.txt</strong>から依存ライブラリのパッケージを確認して、インストールしていくと次のような問題が発生します。</p>\n<pre><code>-----> Python app detected\n-----> Installing python-3.8.5\n-----> Installing pip 20.0.2, setuptools 39.0.1 and wheel 0.34.2\n-----> Installing SQLite3\n-----> Installing requirements with pip\n    Collecting certifi==2020.6.20\n        Downloading certifi-2020.6.20-py2.py3-none-any.whl (156 kB)\n    Collecting chardet==3.0.4\n            ( 中略 )\n    Collecting mecab==0.996.2\n        Downloading mecab-0.996.2.tar.gz (62 kB)\n        ERROR: Command errored out with <span>exit</span> status 1:\n            <span>command</span>: /app/.heroku/python/bin/python -c <span>'import sys, setuptools, tokenize; sys.argv[0] = '</span><span>\"'\"</span><span>'/tmp/pip-install-kr1kq54r/\n            mecab/setup.py'</span><span>\"'\"</span><span>'; __file__='</span><span>\"'\"</span><span>'/tmp/pip-install-kr1kq54r/mecab/setup.py'</span><span>\"'\"</span><span>';f=getattr(tokenize, '</span><span>\"'\"</span><span>'open'</span><span>\"'\"</span><span>', open)\n            (__file__);code=f.read().replace('</span><span>\"'\"</span><span>'\\r\\n'</span><span>\"'\"</span><span>', '</span><span>\"'\"</span><span>'\\n'</span><span>\"'\"</span><span>');f.close();exec(compile(code, __file__, '</span><span>\"'\"</span><span>'exec'</span><span>\"'\"</span><span>'))'</span> \n            egg_info --egg-base /tmp/pip-install-kr1kq54r/mecab/pip-egg-info\n                cwd: /tmp/pip-install-kr1kq54r/mecab/\n        Complete output (10 lines):\n        /bin/sh: 1: mecab-config: not found\n        Traceback (most recent call last):\n            File <span>\"&#x3C;string>\"</span>, line 1, <span>in</span> &#x3C;module>\n            File <span>\"/tmp/pip-install-kr1kq54r/mecab/setup.py\"</span>, line 53, <span>in</span> &#x3C;module>\n            include_dirs=cmd2(<span>\"mecab-config --inc-dir\"</span>),\n            File <span>\"/tmp/pip-install-kr1kq54r/mecab/setup.py\"</span>, line 19, <span>in</span> cmd2\n            <span>return</span> cmd1(strings).split()\n            File <span>\"/tmp/pip-install-kr1kq54r/mecab/setup.py\"</span>, line 15, <span>in</span> cmd1\n            <span>return</span> os.popen(strings).readlines()[0].rstrip()\n        IndexError: list index out of range\n        ----------------------------------------\n    ERROR: Command errored out with <span>exit</span> status 1: python setup.py egg_info Check the logs <span>for</span> full <span>command</span> output.\n    !     Push rejected, failed to compile Python app.\n    !     Push failed</code></pre>\n<p>こんな感じに怒られるわけですよ...orz</p>\n<h2>悪さをするのはMecabだった！？</h2>\n<p>どうやら悪さをしていたのは、<strong>MeCab</strong>だったようです。再度requirements.txtの一部を確認します。</p>\n<pre><code>requirements.txt   |\n----------------------------\ncertifi==2020.6.20\nchardet==3.0.4\nclick==7.1.2\nFlask==1.1.2\ngunicorn==20.0.4\nidna==2.10\nitsdangerous==1.1.0\nJinja2==2.11.2\nMarkupSafe==1.1.1\nmecab==0.996.2\n..................</code></pre>\n<p>どうやら調べてみると、このmecabで指定しているのがよくないみたいですね...</p>\n<p>というわけで、この<strong>mecab==0.996.2</strong>というのをどかしてやりますね。どうするかと言いますと、<br>\n<strong>mecab-python</strong>に変えてあげます。特にバージョンは指定しなくてもよかったです。</p>\n<p>ということで直します。</p>\n<pre><code>requirements.txt   |\n----------------------------\n..................\n..................\nmecab-python       <span># mecab==0.996.2 を修正</span>\n..................</code></pre>\n<p>これでうまくいくはずです！！</p>\n<p>もしうまくいかなかったら、打ち損じとか全角になってないか、他のライブラリでのエラー等を疑うといいと思います。</p>\n<p>これぬまにハマりそうなので、同じエラーに悩む人がいたら是非参考にしてください。</p>\n","Title":"HerokuにMecCabインストールで困った!!","Date":"2020-08-05","Category":"Python","Tags":["Python","MeCab"],"Authors":"ゆうぼう","Slug":"heroku-mecab","Description":"MeCabを利用したWebアプリケーションをHerokuにデプロイしようとして、環境をrequirements.txtにまとめていたのですが、、、どうしてもエラーが出てインストールが止まってしまうことがありました。原因は、Mecabだったようなので、エラー回避方法を共有します。","Published":true},"categories":["Web","JavaScript","Competition","Cloud","Linux","Python","ML","Go","SQL"],"tags":["Apache","Appium","atmaCup","AWS","CentOS7","CentOS8","Colab","conda","CSS","ffmpeg","Flask","Go","Google Colaboratory","Heroku","HTML","JavaScript","JSON","Kaggle","Linux","Mac","make","map","MeCab","ML","MySQL","NLP","node.js","Pandas","Python","Pytorch","pytorch-lightning","Scikit-learn","Selenium","SISR","subprocess","Super-Resolution","tensorflow","Tkinter","zsh","オブジェクト指向","デコレータ","データ分析","特殊メソッド","超解像"]},"__N_SSG":true}